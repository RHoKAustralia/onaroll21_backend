"use strict";function updateUsingUniWebView(e){return usingUniWebView=e,"usingUniWebView: "+usingUniWebView}var userid="",groupid="",missionTitle="",todayMission="",didyouknow="",reference="",taskid="",postAsImg="",usingUniWebView="false",postReportIDs="",commentReportIDs=[],postReportIDs=[],currentUnixTIme=Math.floor(Date.now()/1e3),conversationID="",currentRoute="",appViews={updateProgress:function(e){$(".progress-bar").css({width:e+"%"})},progressError:function(e){$("#progressMsg").html(e),$("#progressMsg").show(),$("#progressLoader").on("click",function(){console.log("PL: Click"),$("#progressMsg").hide(),$(this).off("click"),$("#progressLoader").remove()})}},app=angular.module("oar21",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngUpload","shoppinpal.mobile-menu","ngDialog","ngFileUpload","angular-svg-round-progress"]).config(function(e,t){e.when("/loadApp",{templateUrl:"templates/loading-app.html?v="+currentUnixTIme,controller:"LoadAppCtrl"}).when("/IEDetected",{templateUrl:"templates/iedetected.html?v="+currentUnixTIme}).when("/login",{templateUrl:"templates/login.html?v="+currentUnixTIme,controller:"LoginCtrl"}).when("/login/playerID/:pid",{templateUrl:"templates/login.html?v="+currentUnixTIme,controller:"LoginCtrl"}).when("/forgot-pwd",{templateUrl:"templates/forgotPwd.html?v="+currentUnixTIme,controller:"LoginCtrl"}).when("/newAccount",{templateUrl:"templates/sign-up.html?v="+currentUnixTIme,controller:"SignUpCtrl"}).when("/newAccount/:cc",{templateUrl:"templates/sign-up.html?v="+currentUnixTIme,controller:"SignUpCtrl"}).when("/newAccount/:cc/:token",{templateUrl:"templates/sign-up.html?v="+currentUnixTIme,controller:"SignUpCtrl"}).when("/bypasslogin/:user/:password/:url",{templateUrl:"templates/login.html?v="+currentUnixTIme,controller:"LoginCtrl"}).when("/main",{templateUrl:"templates/posts.html?v="+currentUnixTIme,controller:"WallCtrl"}).when("/journal",{templateUrl:"templates/journal.html?v="+currentUnixTIme,controller:"JournalCtrl"}).when("/play",{templateUrl:"templates/dice.html?v="+currentUnixTIme,controller:"DiceCtrl"}).when("/profile",{templateUrl:"templates/profile.html?v="+currentUnixTIme,controller:"MainCtrl"}).when("/missionCompleted",{templateUrl:"templates/mission-completed.html?v="+currentUnixTIme,controller:"MissionCompletedCtrl"}).when("/messages",{templateUrl:"templates/messages.html?v="+currentUnixTIme,controller:"MessageCtrl"}).when("/messages/:id",{templateUrl:"templates/messages.html?v="+currentUnixTIme,controller:"MessageLocationCtrl"}).when("/notifications",{templateUrl:"templates/notifications.html?v="+currentUnixTIme,controller:"NotificationCtrl"}).when("/nmSelectGroup",{templateUrl:"templates/messagesSelectGroup.html?v="+currentUnixTIme,controller:"MessageSelectGroupCtrl"}).when("/nmSelectUser",{templateUrl:"templates/messagesSelectUser.html?v="+currentUnixTIme,controller:"MessageSelectUserCtrl"}).when("/groupmessage",{templateUrl:"templates/groupMessage.html?v="+currentUnixTIme,controller:"GroupMessageCtrl"}).when("/groupmessage/:roomid",{templateUrl:"templates/groupMessage.html?v="+currentUnixTIme,controller:"GroupMessageCtrl"}).when("/groupMessageList",{templateUrl:"templates/groupMessageList.html?v="+currentUnixTIme,controller:"GroupMessageListCtrl"}).when("/message/:id",{templateUrl:"templates/messageView.html?v="+currentUnixTIme,controller:"MessageViewCtrl"}).when("/message/view/:id",{templateUrl:"templates/messageView.html?v="+currentUnixTIme,controller:"MessageViewCtrl"}).when("/mission",{templateUrl:"templates/mission.html?v="+currentUnixTIme,controller:"MainCtrl"}).when("/wall",{templateUrl:"templates/posts.html?v="+currentUnixTIme,controller:"WallCtrl"}).when("/wall/:postid",{templateUrl:"templates/posts.html?v="+currentUnixTIme,controller:"WallCtrl"}).when("/montage",{templateUrl:"templates/photo-montage.html?v="+currentUnixTIme,controller:"MainCtrl"}).when("/groups",{templateUrl:"templates/group-list.html?v="+currentUnixTIme,controller:"MainCtrl"}).when("/newpost",{templateUrl:"templates/post-new.html?v="+currentUnixTIme,controller:"PostsCtrl"}).when("/editpost",{templateUrl:"templates/editPost.html?v="+currentUnixTIme,controller:"PostEditCtrl"}).when("/accountSettings",{templateUrl:"templates/accountSettings.html?v="+currentUnixTIme,controller:"AccountSettingsCtrl"}).when("/postas",{templateUrl:"templates/post-as.html?v="+currentUnixTIme,controller:"PostAsCtrl"}).when("/presurveyintro",{templateUrl:"templates/presurveyintro.html?v="+currentUnixTIme,controller:"PreSurveyCtrl"}).when("/postsurveyintro",{templateUrl:"templates/postsurveyintro.html?v="+currentUnixTIme,controller:"PostSurveyCtrl"}).when("/postsurvey",{templateUrl:"templates/postsurvey.html?v="+currentUnixTIme,controller:"PostSurveyCtrl"}).when("/presurvey",{templateUrl:"templates/presurvey.html?v="+currentUnixTIme,controller:"PreSurveyCtrl"}).when("/howto",{templateUrl:"templates/how-to-play.html?v="+currentUnixTIme,controller:"HowtoCtrl"}).when("/supportTicket",{templateUrl:"templates/support-ticket.html?v="+currentUnixTIme,controller:"SupportTicketCtrl"}).when("/supportTicketOut",{templateUrl:"templates/support-ticket-outside.html?v="+currentUnixTIme,controller:"SupportTicketCtrl"}).when("/about",{templateUrl:"templates/about.html?v="+currentUnixTIme,controller:"MainCtrl"}).when("/support",{templateUrl:"templates/support.html?v="+currentUnixTIme,controller:"SupportCtrl"}).when("/legal",{templateUrl:"templates/legal.html?v="+currentUnixTIme,controller:"LegalCtrl"}).when("/howtoOutside",{templateUrl:"templates/how-to-play-outside.html?v="+currentUnixTIme,controller:"HowtoOutsideCtrl"}).when("/notificationUserAdmin",{templateUrl:"templates/notificationUserAdmin.html?v="+currentUnixTIme,controller:"NotificationAdminCtrl"}).otherwise({redirectTo:"/main"}),t.directive("compile",function(e){return function(t,o,n){t.$watch(function(e){return e.$eval(n.compile)},function(n){o.html(n),e(o.contents())(t)})}})});app.directive("showsMessageWhenHovered",function(){return{Restrict:"A",link:function(e,t,o){var n=e.message;t.bind("mouseover",function(){e.message=o.message,e.$apply()}),t.bind("mouseout",function(){e.message=o.message,e.$apply()})}}}),app.run(function(e){e.$on("$routeChangeSuccess",function(e,t,o){currentRoute=t.$$route.originalPath})}),app.run(function(e){angular.element(document).on("click",function(t){e.$broadcast("documentClicked",angular.element(t.target))})}),angular.module("oar21").directive("ngEnter",function(){return function(e,t,o){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(o.ngEnter,{event:t})}),t.preventDefault())})}}),app.directive("fileUpload",function(){return{scope:!0,link:function(e,t,o){t.bind("change",function(t){for(var o=t.target.files,n=0;n<o.length;n++)e.$emit("fileSelected",{file:o[n]})})}}}),app.directive("fluidvids",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{video:"@"},template:'<div class="fluidvids"><iframe ng-src="{{ video }}"></iframe></div>',link:function(e,t,o){var n=o.height/o.width*100;t[0].style.paddingTop=n+"%"}}}),app.directive("imageonload",function(){return{restrict:"A",link:function(e,t,o){t.bind("load",function(){e.$apply(o.imageonload)})}}}),app.directive("loadMoreData",[function(){return{restrict:"A",link:function(e,t,o,n){var s=t,r=window.location.hash;$("body").scroll(function(){var t=$(window).scrollTop(),o=t+$(window).height(),n=s.offset().top,r=n+s.height();o>=r&&n>=t&&e.$apply("loadMoreData()")})}}}]),app.directive("termsAgreement",function(){return{restrict:"E",templateUrl:"templates/legal.html"}}),app.directive("moodMap",function(){return{restrict:"E",templateUrl:"templates/widgets/moodmap.html"}}),angular.module("loaded",[]).directive("repeatHelloWorld",function(){return{link:function(e,t,o,n){var s=function(){for(var e=0;e<o.repeatHelloWorld;e++);};s()}}}),angular.module("ng").filter("cut",function(){return function(e,t,o,n){if(!e)return"";if(o=parseInt(o,10),!o)return e;if(e.length<=o)return e;if(e=e.substr(0,o),t){var s=e.lastIndexOf(" ");-1!=s&&(e=e.substr(0,s))}return e+(n||" â€¦")}}),app.directive("pageHeader",function(){return{restrict:"E",templateUrl:"templates/widgets/page-header.html?v="+currentUnixTIme,controller:function(e,t,o){e.sessionUser=angular.fromJson(o.get("user"));var n=["login","forgot-pwd","newAccount","about","legal","supportTicketOut","presurveyintro","presurvey","postsurveyintro","postsurvey"],s=$("#dropdownMenu");e.toggleLeftMenu=function(){$("#side-menu").hasClass("menu-default")?($("#side-menu").show().toggleClass("menu-default menu-slided"),$(".side-menu-layer").show()):($("#side-menu").hide().toggleClass("menu-default menu-slided"),$(".side-menu-layer").hide())},e.toggleRightMenu=function(){$("#group-users-menu").hasClass("menu-default")?($("#group-users-menu").show().toggleClass("menu-default menu-slided"),$(".side-menu-layer").show()):($("#group-users-menu").hide().toggleClass("menu-default menu-slided"),$(".side-menu-layer").hide())},e.$watch(function(){return t.path()},function(t){e.noHeader=!1,e.noFooter=!1;for(var o in n)t.indexOf(n[o])>=0&&(e.noHeader=!0,e.noFooter=!0)})}}}),app.directive("notificationCont",function(){return{restrict:"E",templateUrl:"templates/widgets/notification.html?v="+currentUnixTIme}}),app.directive("postasHeader",function(){return{restrict:"E",templateUrl:"templates/alerts/post-as-ckboxs.html?v="+currentUnixTIme}}),app.directive("sideMenu",function(){return{restrict:"E",templateUrl:"templates/widgets/side-menu.html?v="+currentUnixTIme,link:function(){$(".side-menu-layer, #side-menu a, #side-menu .close-link").click(function(){$("#side-menu").hasClass("menu-slided")&&($("#side-menu").hide().toggleClass("menu-default menu-slided"),$(".side-menu-layer").hide())})}}}),app.directive("groupUsers",function(){return{restrict:"E",templateUrl:"templates/widgets/group-users.html?v="+currentUnixTIme,controller:function(e,t,o,n){$(".side-menu-layer, #group-users-menu .close-link").click(function(){$("#group-users-menu").hasClass("menu-slided")&&($("#group-users-menu").hide().toggleClass("menu-default menu-slided"),$(".side-menu-layer").hide())}),e.closeMenu=function(){$("#group-users-menu").hasClass("menu-slided")&&($("#group-users-menu").hide().toggleClass("menu-default menu-slided"),$(".side-menu-layer").hide())},e.openSingleMessage=function(e){var t=JSON.parse(o.get("user")),s=[],r=null;s.push({id:t.id,full_name:t.firstname+" "+t.lastname},{id:e.id,full_name:e.firstname+" "+e.lastname}),o.set("selectedUsers",JSON.stringify(s)),n.post("/api/service/groupmessage/addUserToConversation",{userlist:JSON.stringify(s),conversationID:r,type:"single"}).success(function(e,t,o,n){location.href="#/message/view/"+JSON.parse(e)})}}}}),app.directive("quicklinksHeader",function(){return{restrict:"E",templateUrl:"templates/widgets/quicklinks-header.html?v="+currentUnixTIme}}),app.directive("groupList",function(){return{restrict:"E",templateUrl:"templates/widgets/group-list.html?v="+currentUnixTIme}}),app.directive("wallWidget",function(){return{restrict:"E",templateUrl:"templates/widgets/wall-widget.html?v="+currentUnixTIme}}),app.directive("photoMontage",function(){return{restrict:"E",templateUrl:"templates/widgets/photo-montage.html?v="+currentUnixTIme}}),app.directive("wordCloud",function(){return{restrict:"E",templateUrl:"templates/widgets/word-cloud.html?v="+currentUnixTIme}}),app.directive("goBack",function(){return{restrict:"A",link:function(e,t,o){t.on("click",function(){"#/main"!=window.location.hash&&window.history.go(-1)})}}}),app.directive("scrollTop",function(){return{restrict:"E",templateUrl:"templates/widgets/scroll-top.html",scope:{id:"="},link:function(){function e(){n.scrollTop()>200?o.fadeIn():o.fadeOut()}function t(){n.animate({scrollTop:0},500)}var o=angular.element(".scroll-to-top"),n=angular.element(".scrollable-wrapper");o.on("click",t),n.on("scroll",e)}}}),app.directive("selectUsers",function(){return{restrict:"E",templateUrl:"templates/widgets/select-users.html",scope:{users:"=",currentUser:"="},controller:function(e,t,o,n){e.openMessage=function(s){e.checkMessage="";var r=t("filter")(s,{checked:!0}),a=JSON.parse(o.get("user"));if(r.length){var i=[],c=1==r.length?"single":"group",l=null;location.href.indexOf("message/view")>=0&&(l=location.href.split("message/view/")[1]),i.push({id:a.id,full_name:a.firstname+" "+a.lastname});for(var p in r)i.push({id:r[p][0].id,full_name:r[p][0].firstname+" "+r[p][0].lastname});o.set("selectedUsers",JSON.stringify(i)),$(".popup-active").toggleClass("popup-inactive popup-active"),n.post("/api/service/groupmessage/addUserToConversation",{userlist:JSON.stringify(i),conversationID:l,type:c}).success(function(e,t,o,n){location.href="#/message/view/"+JSON.parse(e)})}else e.checkMessage="Please select at least one user!"}}}}),app.directive("dropdown",function(e){return{restrict:"E",templateUrl:"templates/widgets/select-dropdown.html",scope:{placeholder:"@",list:"=",selected:"=",property:"@"},link:function(t){t.listVisible=!1,t.isPlaceholder=!0,t.select=function(e){t.isPlaceholder=!1,t.selected=e},t.isSelected=function(e){return e[t.property]===t.selected[t.property]},t.show=function(){t.listVisible=!0},e.$on("documentClicked",function(e,o){!$(o[0]).is(".dropdown-display.clicked")&&!$(o[0]).parents(".dropdown-display.clicked").length>0&&t.$apply(function(){t.listVisible=!1})}),t.$watch("selected",function(e){t.isPlaceholder=void 0===t.selected[t.property],t.display=t.selected[t.property]})}}}),app.directive("alertSuccess",function(){return{restrict:"E",templateUrl:"templates/alerts/success.html"}}),app.directive("alertError",function(){return{restrict:"E",templateUrl:"templates/alerts/error.html"}}),app.directive("alertFeedback",function(){return{restrict:"E",templateUrl:"templates/alerts/feedback.html"}}),app.directive("alertMoodcheck",function(){return{restrict:"E",templateUrl:"templates/alerts/mood-check.html"}}),app.directive("showWordcloud",function(){return{restrict:"A",link:function(){element.on("click",function(){})}}}),app.directive("toggle",function(){return{restrict:"A",link:function(e,t,o){t.on("click",function(){var o=t.data("target");e.resetAll(),e.currentGroup&&(e[o]=1,"displayPhotoMontage"===o?e.photoMontage():"displayWordcloud"===o&&e.displayWordCloud(),e.$apply())})}}}),app.directive("uploadFile",function(){return{scope:{file:"="},link:function(e,t,o){t.bind("change",function(t){var o=t.target.files,n=o[0];e.file=n?n.name:void 0,e.$emit("fileSelected",{file:o[0]})})}}}),app.directive("postScroll",function(e){return{restrict:"A",link:function(){}}}),app.config(function(e){var t=function(e,t,o,n){var s=function(e){return e},r=function(s){return 401===s.status?(o.unset("authenticated"),o.unset("currentSelectedGroup"),o.unset("currentSelectedGroupDetails"),o.unset("user"),o.unset("surveyskipped"),n.show(s.data.flash),e.path("/login"),t.reject(s)):t.reject(s)};return function(e){return e.then(s,r)}};e.responseInterceptors.push(t)}),app.run(function(e,t,o,n,s,r,a,i,c){var l=["/login","/IEDetected","/about","/loadApp","/newAccount","/newAccount/:cc","/newAccount/:cc/:token","/forgot-pwd","/supportTicketOut","/legal","/howtoOutside","/bypasslogin/:user/:password/:url","/login/playerID/:pid"],p=["/newpost"];e.$on("$viewContentLoaded",function(){i.removeAll(),"/login"==t.path()}),e.$on("$routeChangeStart",function(e,n,s){var r=t.path(),a=r.search("/newAccount/"),i=r.search("/bypasslogin/"),c=r.search("/login/playerID/");_(l).contains(t.path())||o.isLoggedIn()||0==a||0==i||0==c||t.path("/login")})}),app.factory("formDataObject",function(){return function(e){var t=new FormData;return angular.forEach(e,function(e,o){t.append(o,e)}),t}}),app.run(function(e,t,o,n,s,r,a){var i=n.get("user"),c=e(function(){a.notification()},1e4);a.notification(),o.emoicon=function(e){var t=$("#emoicon-wrapper").html();$("body").append(t),s(function(){$(".popdown").css("top","0")},500)},o.ajaxLoader=function(){var e="";e+='<div id="progressLoader"><div class="progress-loader"><div class="progress-bar"></div></div><div id="ajax-loader-cover"></div><div id="loader-item"><div id="loader-icon"></div><div id="loader-message" class="theme-text center-align">Please wait</div></div></div>',$("body").prepend(e)},o.removeAjaxLoader=function(){$("#progressLoader").remove()},o.contentWrapperLoader=function(){var e="";e+='<div id="content-wrapper-loader"></div> ',$("body").prepend(e)},o.removeContentWrapperLoader=function(){$("#content-wrapper-loader").fadeOut("fast",function(){$(this).remove()}),$(".content-wrapper").fadeTo("slow",1)},o.contentNotAvailable=function(e,t,o){var n="";n+='<div class="contentNotAvailable">'+t+"</div>",$("#"+e).prepend(n),1==o?$(".contentNotAvailable").css("display","block"):$(".contentNotAvailable").css("display","none")}}),angular.module("ngUpload",[]).directive("uploadSubmit",["$parse",function(e){function t(e,o){e=angular.element(e);var n=e.parent();return o=o.toLowerCase(),n&&n[0].tagName.toLowerCase()===o?n:n?t(n,o):null}return{restrict:"AC",link:function(e,o,n){o.bind("click",function(e){if(e&&(e.preventDefault(),e.stopPropagation()),!o.attr("disabled")){var n=t(o,"form");n.triggerHandler("submit"),n[0].submit()}})}}}]).directive("ngUpload",["$log","$parse","$document",function(e,t,o){function n(e){var t=o.find("head"),n;return angular.forEach(t.find("meta"),function(t){t.getAttribute("name")===e&&(n=t)}),angular.element(n)}var s=1;return{restrict:"AC",link:function(o,r,a){function i(e){o.$isUploading=e}function c(){alert("UPLAOD DONE"),d.unbind("load"),o.$$phase?i(!1):o.$apply(function(){i(!1)});var t=(d[0].contentDocument||d[0].contentWindow.document).body,n;try{n=angular.fromJson(t.innerText||t.textContent)}catch(s){n=t.innerHTML,e.warn("Response is not valid JSON")}o.$$phase?p(o,{content:n}):o.$apply(function(){p(o,{content:n})})}s++;var l={},p=a.ngUpload?t(a.ngUpload):angular.noop,u=a.ngUploadLoading?t(a.ngUploadLoading):null;a.hasOwnProperty("uploadOptionsConvertHidden")&&(l.convertHidden="false"!=a.uploadOptionsConvertHidden),a.hasOwnProperty("uploadOptionsEnableRailsCsrf")&&(l.enableRailsCsrf="false"!=a.uploadOptionsEnableRailsCsrf),a.hasOwnProperty("uploadOptionsBeforeSubmit")&&(l.beforeSubmit=t(a.uploadOptionsBeforeSubmit)),r.attr({target:"upload-iframe-"+s,method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});var d=angular.element('<iframe name="upload-iframe-'+s+'" border="0" width="0" height="0" style="width:0px;height:0px;border:none;display:none">');if(l.enableRailsCsrf){var m=angular.element("<input />");m.attr("class","upload-csrf-token"),m.attr("type","hidden"),m.attr("name",n("csrf-param").attr("content")),m.val(n("csrf-token").attr("content")),r.append(m)}r.after(d),i(!1),r.bind("submit",function g(){var e=o[a.name];return e&&e.$invalid?!1:l.beforeSubmit&&0==l.beforeSubmit(o,{})?!1:(d.bind("load",c),l.convertHidden&&angular.forEach(r.find("input"),function(e){var t=angular.element(e);t.attr("ng-model")&&t.attr("type")&&"hidden"==t.attr("type")&&t.attr("value",o.$eval(t.attr("ng-model")))}),void(o.$$phase?(u&&u(o),i(!0)):o.$apply(function(){u&&u(o),i(!0)})))})}}}]),app.service("AuthenticationService",function(e,t,o,n,s,r){var a=function(e){o.set("authenticated",!0),o.set("user",JSON.stringify(e)),usingUniWebView=e.isOnApp,1==e.notification?1==o.get("liveAppNotificationSession"):0==o.get("liveAppNotificationSession"),o.set("moodCheck",!0)},i=function(){var e=o.get("notificationType");o.clearAll(),o.set("notificationType",e)},c=function(e){"Your account has been suspended"==e?r.newDropdown("notification",5e3,e.flash):r.newDropdown("warning",5e3,e.flash),s.removeAjaxLoader()};return{login:function(t){var o=e.post("/api/auth/login",t);return o.success(a),o.error(c),o},logout:function(){var t=e.get("/api/auth/logout");return t.success(i),t},isLoggedIn:function(){return o.get("authenticated")}}}),app.factory("globalAppNotification",function(e){return{callNotification:function(t,o,n){var s="sent you a message";"newgroupmessage"==o&&(s="sent you a group message"),"newlike"==o&&(s="likes your post"),"newcomment"==o&&(s="has commented on your post"),"newcommentother"==o&&(s="has commented on a post you commented on"),"newgroupmember"==o&&(s="has joined your team"),"missionpending"==o&&(s="have one mission pending"),"missionpending"!=o&&e.newDropdown("notification",5e3,t+" "+s,o,n)},webNotification:function(e){if("Notification"in window)if("granted"===Notification.permission)var t=new Notification(e);else Notification.requestPermission(function(t){if("granted"===t)var o=new Notification(e)});else alert("This browser does not support desktop notification")}}}),app.factory("requestNotificationService",function(e,t,o){var n=0,s=0;return{notification:function(){e.post("/api/global/notificationNum").success(function(e,r,a,i){console.log("Notification Data"),console.log(e),"false"!=e?($(".notification-alert").css("display","block"),$("#side-nav-notification-number").css("display","block")):($(".notification-alert").css("display","none"),$("#side-nav-notification-number").css("display","none")),e.count>10?($(".notification-alert").html("10+"),$("#side-nav-notification-number").html("10+")):($(".notification-alert").html(e.count),$("#side-nav-notification-number").html(e.count));var c=JSON.parse(t.get("user"));"true"==t.get("liveAppNotificationSession")&&("false"==e?(s=1,$("#side-nav-notification-number").css("display","none"),$("#side-nav-message-number").css("display","none")):(1==e.count&&1==s&&1!=n&&o.callNotification(e.user[0].firstname+" "+e.user[0].lastname,e.type,e.source_id),e.count>n&&0!=n&&("message"==e.type?o.callNotification(e.user[0].firstname+" "+e.user[0].lastname,e.type,e.source_user_id):o.callNotification(e.user[0].firstname+" "+e.user[0].lastname,e.type,e.source_id),n=0))),n=e.count})}}}),app.service("dropdownService",function(e,t,o,n,s,r,a){var i=[],c=null,l=null,p,u,d=4e6,m="",g=0,f=this.newDropdown=function(e,t,n,s,r){var a;switch(m=e,e){case"notification":var c="";switch(s){case"message":c="/#/message/"+r;break;case"newgroupmessage":c="/#/message/view/"+r;break;case"newlike":case"newcomment":case"newcommentother":c="/#/wall/"+r}a="<a href='"+c+"'><div class='popdown notification-green'><div class='notification-msg'><h4>"+n+"</h4></div></div></a>";break;case"warning":a='<div class="popdown warning-red"><div class="notification-msg"><h4>'+n+"</h4></div></div>";break;case"emotion":a='<div class="popdown container" id="emoicon"><div class="notification-type"><h3>How are you feeling?</h3></div><div class="notification-msg"><a href="#/main/mood/1"><div class="emoji-mood-container"><div class="mood-emoji emoji-5">&nbsp;</div><div class="mood-description"><p>Terrible</p></div></div></a><a href="#/main/mood/2"><div class="emoji-mood-container"><div class="mood-emoji emoji-4">&nbsp;</div><div class="mood-description"><p>Not Great</p></div></div></a><a href="#/main/mood/3"><div class="emoji-mood-container"><div class="mood-emoji emoji-3">&nbsp;</div><div class="mood-description"><p>Okay</p></div></div></a><a href="#/main/mood/4"><div class="emoji-mood-container"><div class="mood-emoji emoji-2">&nbsp;</div><div class="mood-description"><p>Good</p></div></div></a><a href="#/main/mood/5"><div class="emoji-mood-container"><div class="mood-emoji emoji-1">&nbsp;</div><div class="mood-description"><p>Fantastic</p></div></div></a></div></div>';break;case"pushNotificationReminder":a='<div class="popdown notification-green"><div class="notification-msg"><h4>'+n+"</h4></div></div>";break;case"reportCommentConfirmation":a='<div class="popdown notification-green"><div class="notification-msg"><h4>'+n+"</h4></div></div>";break;case"reportPostConfirmation":a='<div class="popdown notification-green"><div class="notification-msg"><h4>'+n+"</h4></div></div>";break;case"reportCompletedNotification":a="<div class='popdown notification-green'><div class='notification-msg'><h4>"+n+"</h4></div></div>"}a=a.replace(/['"]/g,"&quot;"),o.get("notificationType")!=n&&(i.push('{"html" : "'+a+'", "duration" : '+t+" }"),o.set("notificationType",n),g++,i.length<=1&&h())},h=this.dropdownIn=function(){if(i.length>0){var t=JSON.parse(i[0]).html;t=t.replace(/&quot;/g,'"');var n=t;$("body").append(n),"emotion"!=m&&$(".popdown").click(function(){v(),"pushNotificationReminder"==m&&(window.location.href="#/notificationUserAdmin"),o.unset("notificationType")}),"reportCommentConfirmation"==m&&$(".popdown").click(function(){v(),o.unset("notificationType"),e.post("/api/comment/report",{postid:commentReportIDs.post_id,commentid:commentReportIDs.comment_id,userid:commentReportIDs.user_id,groupid:commentReportIDs.group_id}).then(function(e){console.log(e),setTimeout(function(){f("reportCompletedNotification",1e4,"The comment has been reported as inappropriate")},1200)}),$("#comment-report-"+commentReportIDs.comment_id).remove(),o.unset("notificationType")}),"reportPostConfirmation"==m&&$(".popdown").click(function(){v(),o.unset("notificationType"),console.log("ss"),console.log(postReportIDs),e.post("/api/post/report",{postid:postReportIDs.post_id,userid:postReportIDs.user_id,groupid:postReportIDs.group_id}).then(function(e){console.log("Send Email : OK"),setTimeout(function(){f("reportCompletedNotification",5e3,"The post has been reported as inappropriate")},1200)}),$("#post-report-"+postReportIDs.post_id).remove(),o.unset("notificationType")}),w(JSON.parse(i[0]).duration)}},v=this.dismissDropdown=function(e){$(".popdown").css("top","-14%"),setTimeout(function(){$(".popdown").remove(),i.shift(),h()},1e3)},w=this.activeDropDown=function(e){function t(){return function(){$(".popdown").css("top","0"),setTimeout(function(){$(".popdown").css("top","-14%"),setTimeout(function(){$(".popdown").remove(),i.shift(),o.unset("notificationType"),g=0,h()},1e3)},d)}}d=e,setTimeout(t(),500)}}),app.factory("FlashService",function(e){return{show:function(t){e.removeAjaxLoader()},showSuccess:function(t){e.successMessage=t},showError:function(t){e.errorMessage=t},clear:function(){e.flash="",e.successMessage="",e.errorMessage=""}}}),app.factory("SessionService",function(){return{get:function(e){return sessionStorage.getItem(e)},set:function(e,t){return sessionStorage.setItem(e,t)},unset:function(e){return sessionStorage.removeItem(e)},clearAll:function(){return sessionStorage.clear()}}}),app.service("APICallService",function(e,t,o,n,s,r,a){return{getNativeAppStatus:function(){var t=e({method:"GET",url:"/api/global/isNativeApp",data:{}});return t},addPost:function(e){return a.http({method:"POST",url:"api/add/post",headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;return t.append("post",angular.toJson(e.postData)),t.append("file",e.file),t},data:{postData:e,file:e.status_file}}).progress(function(e){appViews.updateProgress(parseInt(100*e.loaded/e.total))})},fetchPosts:function(e,t){},fetchPendingTask:function(t,o){console.log("fetchPendingTask"),e.post("/api/mission/getPendingTask",{groupid:o}).success(function(e,t,o,s){console.log("getPendingTask-success");var r={title:e.title,mission:e.mission,didyouknow:e.didyouknow,reference:e.reference,taskid:e.taskid};n.set("pendingTaskDetails",angular.toJson(r)),n.set("pendingTask",e.taskid),$("#hideCurrentMission").css("display","none")}).error(function(e,t,o,n){console.log("error")})},fetchPendingT:function(t,o){e.post("/api/mission/getPendingTask",{groupid:o}).success(function(e,t,o,s){$scope.pendingTaskDetails={title:e.title,didyouknow:e.didyouknow,reference:e.reference,taskid:e.taskid},n.set("pendingTaskDetails",angular.toJson($scope.pendingTaskDetails)),n.set("pendingTask",e.taskid),$("#hideCurrentMission").css("display","none")}).error(function(e,t,o,n){})},likePost:function(t,o,n){var s=e({method:"POST",url:"/api/user/post/like",data:{userid:t,groupid:o,postid:n}});return s},acceptMission:function(t,o,s){return n.get("pendingTask")?void 0:e({url:"/api/user/acceptmission",method:"POST",data:{userid:t,groupid:o,taskid:s}})},fetchWellbeingTracks:function(t){console.log("Groupid: "+t),e({url:"api/user/wellbeingtracks",method:"POST",data:{groupid:t}}).then(function(e){console.log("Wellbeing data fetched"),console.log(e.data),n.set("moodmap",angular.toJson(e.data))})},fetchWellbeingData:function(t){return console.log("Groupid: "+t),e({url:"api/user/wellbeingtracks",method:"POST",data:{groupid:t}})},addComment:function(t){var o={comment:t.comment,post_id:t.post_id,user_id:t.user_id};e({url:"api/add/comment",method:"POST",data:{comment:t.comment,post_id:t.post_id,user_id:t.user_id}}).then(function(e){})},markSurveyComplete:function(o){e({url:"api/user/survey/complete",method:"POST",data:{survey:o}}).then(function(){t.path("/main")})},updateMood:function(t,o){return e({url:"api/user/mood/update",method:"POST",data:{groupid:t,mood:o}})},updateTaskScore:function(t,o){return e({url:"api/user/taskscore",method:"POST",data:{taskid:t,score:o}})},progressBar:function(e){return console.log("Sending the feedback"),"string"},sendFeedback:function(t){return e({url:"api/user/feedback",method:"POST",data:{feedback:t}})}}}),app.filter("htmlStripper",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}}),app.controller("LoginCtrl",function(e,t,o,n,s,r,a,i,c,l,p){e.Lang=t.Lang;var u="",d=localStorage.getItem("username");d&&(u=localStorage.getItem("username")),e.loginMessage="",r.getNativeAppStatus().success(function(e){usingUniWebView=e});var m=n.path();"/forgot-pwd"!=m&&a.logout(),l.contentWrapperLoader(),i.set("preSurveyCompleted",0),i.set("postSurveyCompleted",0),e.remember_username=!0,e.credentials={username:u,password:""},1==l.fromResetPwd&&(p.newDropdown("notification",5e3,"Success. Check email"),l.fromResetPwd=0),e.credentials.username?$("#pword").focus():$("#uname").focus(),l.removeContentWrapperLoader(),e.login=function(){var t=e.credentials;if(e.loginMessage="",t.username?t.password||(e.loginMessage="Please enter password",$("#pword").focus()):(e.loginMessage="Please enter email",$("#uname").focus()),""==e.loginMessage)l.ajaxLoader(),a.login(e.credentials).success(function(t){n.path("/main"),e.storeUsername(),l.removeAjaxLoader()}).error(function(e){});else var o=n.path()},e.resetPwd=function(){e.errorMessage="";var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/;e.emailforreset&&t.test(e.emailforreset)?(l.ajaxLoader(),c.post("/api/service/forgotpwd",{email:e.emailforreset}).success(function(e,t,o,s){"OK"==e?(l.fromResetPwd=1,n.path("/login")):p.newDropdown("warning",5e3,e),l.removeAjaxLoader()})):e.errorMessage="Please enter a valid email"},e.logout=function(){a.logout()},e.navigateTo=function(e){n.path("/"+e)},e.rememberUsername=function(){e.remember_username?e.remember_username=!1:e.remember_username=!0},e.storeUsername=function(){e.remember_username?localStorage.setItem("username",e.credentials.username):localStorage.setItem("username","")},e.$on("$viewContentLoaded",function(){$("#page-loader").hide(),$(".content-wrapper").css("display","0")}),l.removeAjaxLoader()}),app.controller("ByPassCtrl",function(e,t,o,n,s,r,a,i,c){var l={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="",o,n,s,r,a,i,c,p=0;for(e=l._utf8_encode(e);p<e.length;)o=e.charCodeAt(p++),n=e.charCodeAt(p++),s=e.charCodeAt(p++),r=o>>2,a=(3&o)<<4|n>>4,i=(15&n)<<2|s>>6,c=63&s,isNaN(n)?i=c=64:isNaN(s)&&(c=64),t=t+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(i)+this._keyStr.charAt(c);return t},decode:function(e){var t="",o,n,s,r,a,i,c,p=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");p<e.length;)r=this._keyStr.indexOf(e.charAt(p++)),a=this._keyStr.indexOf(e.charAt(p++)),i=this._keyStr.indexOf(e.charAt(p++)),c=this._keyStr.indexOf(e.charAt(p++)),o=r<<2|a>>4,n=(15&a)<<4|i>>2,s=(3&i)<<6|c,t+=String.fromCharCode(o),64!=i&&(t+=String.fromCharCode(n)),64!=c&&(t+=String.fromCharCode(s));return t=l._utf8_decode(t)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",o=0;o<e.length;o++){var n=e.charCodeAt(o);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),
t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){for(var t="",o=0,n=c1=c2=0;o<e.length;)n=e.charCodeAt(o),128>n?(t+=String.fromCharCode(n),o++):n>191&&224>n?(c2=e.charCodeAt(o+1),t+=String.fromCharCode((31&n)<<6|63&c2),o+=2):(c2=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),o+=3);return t}};console.log(o),e.credentials={username:"Master Roller lp001",password:"Master123$"};var p=e.credentials,u="";s.login(e.credentials).success(function(t){n.path("/main"),e.storeUsername()}),e.storeUsername=function(){e.remember_username?localStorage.setItem("username",e.credentials.username):localStorage.setItem("username","")}}),app.controller("SignUpCtrl",function(e,t,o,n,s,r,a,i,c,l,p){e.Lang=t.Lang;var u="",d=localStorage.getItem("username"),m=!1;e.lastID="",e.errorMessage="",e.showStep1=!0,e.showStep2=!1,e.showStep3=!1,$("#signup-firstname").focus(),r.unset("liveAppNotificationSession"),r.unset("lastCompletedMission"),r.unset("messageGroupUser"),r.unset("messageid"),r.unset("messageusername"),r.unset("moodCheck"),r.unset("postSurveyCompleted"),r.unset("preSurveyCompleted"),r.unset("usertemp"),c.contentWrapperLoader(),e.isDisabled="false",e.newuser={firstname:r.get("temp.fname"),lastname:r.get("temp.lname"),username:r.get("temp.uname"),password:r.get("temp.pword"),email:r.get("temp.email"),confirmemail:r.get("temp.cemail")},e.keycode=r.get("temp.kcode"),e.receiveNotifications=function(){m=document.getElementById("receive-chrome-pn").checked,1==m&&registerForPush()},i.cc&&(e.keycode=i.cc,e.token=i.token,e.isDisabled="true"),e.checkKeyCode=function(e){},$("#signup-form input[type='text'], #signup-form input[type='password']").on("keyup keydown keypress",function(e){var t=$(this).parents(".form-step").attr("id");13==e.keyCode&&e.preventDefault()}),e.previousStep=function(t){var o="showStep"+t,n="showStep"+(t+1);e[o]=!0,e[n]=!1},e.enterStep2=function(){e.errorMessage1="",e.newuser.firstname&&e.newuser.lastname?(e.showStep1=!1,e.showStep2=!0):e.newuser.firstname?e.newuser.lastname||(e.errorMessage1="Please enter last name",$("#signup-lastname").focus()):(e.errorMessage1="Please enter first name",$("#signup-firstname").focus())},e.enterStep3=function(){e.errorMessage2="";var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/;e.newuser.email&&t.test(e.newuser.email)?a.post("/api/signup/isEmailExist",{email:e.newuser.email}).success(function(t,o,n,s){"true"==t?(e.errorMessage2="This email already exists",$("#signup-email").focus()):e.newuser.password?e.newuser.confirmpassword&&e.newuser.confirmpassword==e.newuser.password?(e.showStep2=!1,e.showStep3=!0):(e.errorMessage2="Password does not match!",$("#signup-confirmpass").focus()):(e.errorMessage2="Please enter password",$("#signup-pass").focus())}):(e.errorMessage2="Please enter a valid email",$("#signup-email").focus())},e.signUp=function(){e.errorMessage3="",e.newuser.keycode=e.keycode,e.newuser.token=e.token,e.newuser.keycode&&e.newuser.securitycode&&e.newuser.tos?(c.ajaxLoader(),a.post("/api/servcie/signup",e.newuser).success(function(t,n,s,i){return r.set("lastID",t.user_id),"true"==t.status?(o.path("/login"),l.newDropdown("notification",5e3,"Thanks. You can login below"),m&&pushUsersDeviceToDB(),p(function(){var e=r.get("playerid");a.get("https://onesignal.com/api/v1/players/"+e).success(function(e,t,o,n){a.post("/api/service/writePNtoDB",e).success(function(e,t,o,n){})})},3e3)):(e.errorMessage3=t.status,"Incorrect answer"==t.status?$("#signup-security").focus():"Your keycode is invalid"==t.status&&$("#keycode").focus()),c.removeAjaxLoader(),document.getElementById("secuimage").src="/securimage/securimage_show.php?"+Math.random(),!1;document.getElementById("securityinput").value=""})):e.newuser.securitycode?e.newuser.keycode?e.newuser.tos||(e.errorMessage3="Please agree to agreement"):(e.errorMessage3="Please enter key code",$("#keycode").focus()):(e.errorMessage3="Please answer the question in the picture",$("#signup-security").focus()),r.unset("temp.fname"),r.unset("temp.lname"),r.unset("temp.uname"),r.unset("temp.pword"),r.unset("temp.email"),r.unset("temp.cemail"),r.unset("temp.kcode"),r.unset("temp.state")},c.removeContentWrapperLoader(),e.saveTemporaryData=function(){""!=e.newuser.firstname&&(e.userTemp={firstname:e.newuser.firstname},r.set("usertemp",e.userTemp))}}),app.controller("MainCtrl",function(e,t,o,n,s,r,a,i,c,l,p){e.Lang=t.Lang,e.groupname="Mark's Happy Rollers",e.message="This is a test message",e.headMessage="",e.$watch(function(){return s.get("currentSelectedGroup")},function(t,o){e.currentGroup=null,e.currentGroup=JSON.parse(t),a.post("/api/group/user",{id:e.currentGroup}).success(function(t,o,n,s){e.groupUsers=t})}),e.$watch(function(){return s.get("user")},function(t,o){t&&(e.currentUser=JSON.parse(t),e.sessionUser=JSON.parse(t),e.setupGroup())}),e.currentSelectedGroupDetails=angular.fromJson(s.get("currentSelectedGroupDetails")),e.getGroupList=function(){return a.post("/api/group/list")},e.setCurrentGroup=function(t){s.set("currentSelectedGroup",t),s.unset("pendingTask"),s.unset("pendingTaskDetails"),e.currentGroup=t,e.flash="",angular.forEach(e.groups,function(o,n){o.id===t&&(e.currentSelectedGroupDetails=o,s.set("currentSelectedGroupDetails",angular.toJson(o)))}),l.fetchPendingTask(e.sessionUser.id,e.currentGroup),e.pendingTaskDetails=s.get("pendingTaskDetails"),e.pendingTask=s.get("pendingTask");var o=JSON.parse(s.get("currentSelectedGroupDetails"));e.headMessage=o.name},e.setupGroup=function(){e.getGroupList().then(function(t){var n=Math.round(+new Date/1e3);s.set("numOfDaysPassed",t.data[0].daysPassed);var r=localStorage.getItem("loginRedirect");null!=r&&(o.path("/"+r),localStorage.removeItem("loginRedirect")),e.hideGroupSelection=1,e.groups=t.data,e.setCurrentGroup(e.sessionUser.groups[0].id),e.currentGroup?a.post("/api/survey/isPresurveyCompleted",{groupid:e.currentGroup}).success(function(e,t,n,r){"true"==e?s.set("preSurveyCompleted",1):o.path("/presurveyintro")}):(e.displayGroupList=1,e.currentGroup=0)})},"null"==s.get("notificationType")&&s.unset("notificationType"),e.setHeader=function(e){$("#page-title").html(e)},e.navigateTo=function(e){"play"==e?100==s.get("progressPercentage")?(o.path("/missionCompleted"),p.newDropdown("notification",2500,"Fantastic - goal completed!")):s.get("numOfDaysPassed")==s.get("taskCompleted")?s.get("pendingTaskDetails")?p.newDropdown("notification",2500,"Please complete pending mission"):p.newDropdown("notification",2500,"Missions up to date. Roll again tomorrow!"):o.path("/play"):o.path("/"+e)},e.setActiveMenu=function(e){$("#header ul a").removeClass("active"),$("#mobile-nav a").removeClass("active"),"none"!=e&&($("#header ul a#link-"+e).addClass("active"),$("#mobile-nav a#menu-"+e).addClass("active"))},e.togglePopup=function(e){$(".popup-"+e).toggleClass("popup-inactive popup-active"),"active"==e&&$("#full-image img").hide()},e.pendingTask=function(){a.post("/api/mission/getPendingTask",{groupid:e.currentGroup}).success(function(t,o,n,r){1==t.date&&"true"!=s.get("missionPending")&&(s.set("missionPending","true"),c.callNotification("You","missionpending")),e.pendingTaskDetails={title:t.title,didyouknow:t.didyouknow,reference:t.reference,taskid:t.taskid,date:t.date},s.set("pendingTaskDetails",angular.toJson(e.pendingTaskDetails)),s.set("pendingTask",t.taskid),$("#hideCurrentMission").css("display","none")}).error(function(e,t,o,n){})},e.pendingTask(),e.currentGroupNotSelected=function(){return s.get("currentSelectedGroup")?!1:!0},e.logout=function(){r.logout(),o.path("/login")}}),app.controller("JournalCtrl",function(e,t,o,n,s,r,a,i,c,l,p){e.headTitle="journal",e.headMessage="",e.displayWordcloud=0,e.displayGroupList=0,e.displayWall=0,e.displayPhotoMontage=0,e.displayMoodMap=0,e.posts="",e.wordCloud="",e.photos="",e.progress=0,e.weekday=moment().format("dddd"),e.date=moment().format("DD"),e.dialProgress=null,e.userProgress=null,e.setHeader("Journal"),e.setActiveMenu("journal");var u=new Date,d=("0"+u.getDate()).slice(-2),m=("0"+(u.getMonth()+1)).slice(-2),g=u.getFullYear()+"-"+m+"-"+d;e.month=moment().format("MM"),e.montageCreated=0,e.ppb=0;var f=1e4,h=3e4,v=null;e.randomIMG=Math.floor(Math.random()*(h-f+1))+f,i.contentWrapperLoader(),$(window).width()<=499&&($(".progress-circle").click(function(){$(this).hide(),$(".progress-detailed-info").show()}),$(".progress-detailed-info").click(function(){$(this).hide(),$(".progress-circle").show()}));var w=t.path().search("/main/mood");0==w&&s({url:"api/global/moodCheckTime",method:"POST"}),1==e.sessionUser.role&&(e.complete=!0),e.resetAll=function(){e.displayWordcloud=0,e.displayGroupList=0,e.displayWall=0,e.displayPhotoMontage=0,e.displayMoodMap=0},e.setupCharts=function(t){console.log("Set up charts"),e.flash="",l.progressBar(t),l.fetchWellbeingData(e.currentGroup).success(function(t){v=t,e.getMoodData(),e.startMoodMapAni()}),e.getMoodData=function(){s({url:"api/global/getProgress",method:"POST",data:{groupid:e.currentGroup}}).then(function(t){console.log("Progress Data"),console.log(t);var o=t.data.progress;c.set("progressPercentage",o),e.ppb=o,e.InitUserProgress(t.data,e)})},e.resetAll(),e.displayMoodMap=1},e.setupCharts(),e.loadProgress=function(t){if(Date.now||(Date.now=function(){return(new Date).getTime()}),e.preSurveyCompleted=c.get("preSurveyCompleted"),e.postSurveyCompleted=c.get("postSurveyCompleted"),e.preSurveyCompleted?e.postSurveyCompleted||c.set("postSurveyCompleted",e.currentSelectedGroupDetails.postSurveyCompleted):c.set("preSurveyCompleted",e.currentSelectedGroupDetails.preSurveyCompleted),e.currentGroup){var o=Math.floor(21-(Math.floor(Date.now()/1e3)-e.currentSelectedGroupDetails.timestart)/86400);e.headMessage=e.currentSelectedGroupDetails.name}else{var o=0;e.headMessage="Please select team"}if(e.currentDay=o,0===e.currentGroup){var n=0;e.progress=0}else if(e.currentDay<=0){var n=100;e.progress=n,e.getWallPosts()}else{var n=Math.floor(e.currentDay/21);e.progress=n,e.getWallPosts()}},e.mysql_to_unix=function(e){return Math.floor(new Date(e).getTime()/1e3)},e.getWallPosts=function(){var t=s({method:"POST",url:"/api/group/private/posts",data:{groupid:e.currentGroup}});t.success(function(t){e.posts=t,t.length<1&&$(".journal-wall-posts").html(e.noPost)})},e.getWordsForCloud=function(){$("#tagcloud").html(e.disabledFeatureMsg)},e.getPhotosForMontage=function(){s.post("/api/user/photos").success(function(t){e.photos=t})},e.canDisplay=function(t){if("currentmission"===t){if(e.currentGroup&&c.get("pendingTask"))return!1}else if("play"===t&&e.currentGroup&&!c.get("pendingTask"))return!1;return!0},e.dothis=function(){},e.$on("$viewContentLoaded",function(t){console.log("=========="),console.log(e.sessionUser),"1"==e.sessionUser.notification?c.set("liveAppNotificationSession","true"):c.set("liveAppNotificationSession","false"),"0"==e.sessionUser.push_notification&&"true"!=c.get("chromeReminderFlag")&&c.set("chromeReminderFlag","true"),r(function(){s({url:"api/global/taskCompleted",method:"POST"}).then(function(e){c.set("taskCompleted",e.data)}),i.removeContentWrapperLoader(),setTimeout(function(){console.log("REGISTRERD USSER DATE "+e.mysql_to_unix(e.sessionUser.created_at));var t=Math.round(+new Date/1e3);e.hideGroupSelection=1,console.log("===="),console.log(c.get("user")),console.log("===="),e.getWordsForCloud(),e.getPhotosForMontage(),e.resetAll(),1===e.sessionUser.groupCount&&1!=e.sessionUser.role?e.displayGroupList=0:(e.hideGroupSelection=0,e.displayGroupList=1,i.removeContentWrapperLoader()),e.currentGroup?(e.resetAll(),e.displayMoodMap=1,e.loadProgress(e.currentGroup)):(e.resetAll(),e.displayGroupList=1,e.currentGroup=0),setTimeout(function(){e.currentGroup||p.newDropdown("notification",4e7,"Please select a team")},4e3)},1e3)}),100==c.get("progressPercentage")&&(e.allCompleted=!0,$(".button-gre").remove())}),e.humanReadable=function(e){return moment(e).fromNow()},e.UserProgress=function(t){var o=e.UserProgress._width,n=e.UserProgress._height,s=e.UserProgress._day,r=e.UserProgress._date,a=e.UserProgress._progress,i=0,c=e.UserProgress._completedDays;t.lightBlue=t.color(47,143,188),t.darkBlue=t.color(24,82,110),t.cream=t.color(242,208,141),t.setup=function(){t.size(o,n),t.frameRate(35),t.background(0,0),t.textFont(t.createFont("Raleway",30))},t.draw=function(){if(t.background(0,0),t.strokeWeight(n/20),t.stroke(t.darkBlue),t.fill(t.lightBlue),t.ellipse(o/2,n/2,.75*n,.75*n),t.noFill(),t.strokeWeight(n/15),t.stroke(t.cream),t.strokeCap(t.SQUARE),i+=(a-i)/4,t.arc(o/2,n/2,.84*n,.84*n,t.radians(270),t.radians(270+3.6*i)),Math.round(a)==Math.round(i)&&t.arc(o/2,n/2,.84*n,.84*n,t.radians(270),t.radians(270+3.6*a)),t.smooth(),t.maxFontSize=.2,t.textSize(t.maxFontSize*(1.4*n)),t.prog_str=i.toFixed(0)+"%",t.percent_width=t.textWidth(t.prog_str),t.fill(t.cream),t.text(t.prog_str,.5*(o-t.percent_width),.53*n),t.textSize(t.maxFontSize*(.35*n)),t.prog_str="complete!",t.percent_width=t.textWidth(t.prog_str),t.fill(t.cream),t.text(t.prog_str,.5*(o-t.percent_width),.64*n),t.textSize(t.maxFontSize*(.35*n)),t.prog_str="Day "+c,t.percent_width=t.textWidth(t.prog_str),t.fill(t.darkBlue),t.text(t.prog_str,.5*(o-t.percent_width),.78*n),Math.round(a)==Math.round(i)){t.noLoop();var e=Math.round(+new Date/1e3)}}},e.InitUserProgress=function(t,o){console.log("Init User Progress");var n=t.progress;e.progressPercent=t.progress,e.totalMissions=t.total_mission,e.completedDays=t.completed_days,console.log("PROGRESS DATA"),console.log(t),e.completedMissions=t.completed_missions,e.userProgress=n,e.complete=!0,e.drawProgress(n)},$(window).resize(function(){e.dialProgress=0,e.drawProgress()}),e.drawProgress=function(){e.dialProgress=e.userProgress,$(window).width()>=375?e.progressRadius=75:e.progressRadius=57},e.MoodMap=function(t){t.lightBlue=t.color(47,143,188),t.darkBlue=t.color(24,82,110),t.cream=t.color(242,208,141),t.white=t.color(242,208,141),t.title="MOOD MAP";var o=e.MoodMap._width,n=e.MoodMap._height,s=e.MoodMap._moodPoints,r=[],a=0;t.setup=function(){t.size(o,n),t.frameRate(35),t.background(0,0),t.textFont(t.createFont("Raleway",30));for(var e=0;e<s.length;e++)r[e]=t.height;console.log("moodpoints: "+s),console.log("MoodMap.height: "+t.height)},t.draw=function(){t.background(0,0),t.spacing_h=t.width/s.length,t.spacing_v=.75*t.height/7,t.padding=t.spacing_h/2,t.moodHigh=new PVector(0,t.height),t.prevPoints;for(var o=0;o<s.length;o++){t.noStroke(),t.fill(t.white),t.x=t.padding+t.spacing_h*o;var n=t.height-t.spacing_v*s[o]+75;t.y=r[o]+=(n-r[o])/8,t.ellipse(t.x,t.y,5,5),o>0&&(t.stroke(t.white),t.strokeWeight(2),t.line(t.prevPoints.x,t.prevPoints.y,t.x,t.y)),t.y<t.moodHigh.y&&(t.moodHigh.x=t.x,t.moodHigh.y=t.y),t.prevPoints=new PVector(t.x,t.y)}t.strokeWeight(0),t.stroke(t.white,50),t.noFill();var i=e.MoodMap._moodPoints.length,c=Math.round(t.height-t.spacing_v*s[i-1]),l=Math.round(r[i-1]),p=a+=(t.width-a)/i;if(c==l||0==i){t.noLoop();var u=1e3,d=10;$(".bar1").delay(0).animate({width:d*e.MoodMap.bar1_width+"%",overflow:"auto !important"},u),$(".bar2").delay(500).animate({width:d*e.MoodMap.bar2_width+"%",overflow:"auto !important"},u),$(".bar3").delay(1e3).animate({width:d*e.MoodMap.bar3_width+"%",overflow:"auto !important"},u),$(".bar4").delay(1500).animate({width:d*e.MoodMap.bar4_width+"%",overflow:"auto !important"},u),$(".bar5").delay(2e3).animate({width:d*e.MoodMap.bar5_width+"%",overflow:"auto !important"},u,function(){var e=Math.round(+new Date/1e3)}),$(".emoji-usage1").html(e.MoodMap.bar1_width),$(".emoji-usage2").html(e.MoodMap.bar2_width),$(".emoji-usage3").html(e.MoodMap.bar3_width),$(".emoji-usage4").html(e.MoodMap.bar4_width),$(".emoji-usage5").html(e.MoodMap.bar5_width)}}},e.getRandomMood=function(e,t){return Math.round(e+Math.random()*t)},e.InitMoodMap=function(){e.MoodMap.bar1_width=0,e.MoodMap.bar2_width=0,e.MoodMap.bar3_width=0,e.MoodMap.bar4_width=0,e.MoodMap.bar5_width=0,e.MoodMap._moodPoints=new Array;for(var t=v.length,o=0;t>o;o++)e.MoodMap._moodPoints.push(2*(parseInt(v[o].mood,0)+1)),1===parseInt(v[o].mood,0)?e.MoodMap.bar1_width+=1:2===parseInt(v[o].mood,0)?e.MoodMap.bar2_width+=1:3===parseInt(v[o].mood,0)?e.MoodMap.bar3_width+=1:4===parseInt(v[o].mood,0)?e.MoodMap.bar4_width+=1:5===parseInt(v[o].mood,0)&&(e.MoodMap.bar5_width+=1);e.MoodMap._width=500/7*e.MoodMap._moodPoints.length,e.MoodMap._height=$(".mood-data").height()},e.startMoodMapAni=function(){e.InitMoodMap();var t=document.getElementById("mood-map"),o=new Processing(t,e.MoodMap)},i.mood=e.updateMood=function(t){a.log(t),l.updateMood(e.currentGroup,t).then(function(t){a.log(t),$("#emoicon").remove(),$(".mood-map").empty().append("<canvas class='canvas-mood-map' id='mood-map'></canvas>");var o=document.getElementById("mood-map"),n=new Processing(o,e.MoodMap);location.reload()}),c.set("moodCheck",!1),p.dismissDropdown(1)},n.moodcode&&e.updateMood(n.moodcode),e.photoMontage=function(){$(".photo-container").html(e.disabledFeatureMsg)},e.displayWordCloud=function(){}}),app.controller("DiceCtrl",function(e,t,o,n,s,r,a,i,c,l){e.currentSelectedGroupDetails=angular.fromJson(a.get("currentSelectedGroupDetails")),e.headTitle="play",e.headMessage=e.currentSelectedGroupDetails.name,e.user=angular.fromJson(a.get("user")),e.groupid=a.get("currentSelectedGroup"),e.pendingTaskDetails=angular.fromJson(a.get("pendingTaskDetails")),e.pendingTask=a.get("pendingTask"),e.setHeader("Roll"),e.setActiveMenu("play"),e.groupid?e.pendingTask&&n.path("/mission"):n.path("/main"),userid=e.user.id,groupid=e.groupid,e.getTask=function(){},e.areAllTasksDone=function(){c.post("/api/global/areAllTasksDone",{groupid:e.groupid}).success(function(e,t,o,s){"false"==e?$(".top-layer-dice").css("display","none"):n.path("/missionCompleted")})},e.areAllTasksDone(),e.$on("$viewContentLoaded",function(){t.contentWrapperLoader(),init(),initDiceNum(),render(),s(i.clear,5e3),t.removeContentWrapperLoader()})}),app.controller("MissionCtrl",function(e,t,o,n,s,r){if(e.todayMission="",e.didyouknow="",e.reference="",e.taskid="",e.taskno="",e.user=angular.fromJson(n.get("user")),e.groupid=n.get("currentSelectedGroup"),e.pendingTaskDetails=angular.fromJson(n.get("pendingTaskDetails")),e.pendingTask=n.get("pendingTask"),e.headTitle="Mission",e.headMessage="Add a new post",e.setHeader("Mission"),e.setActiveMenu("play"),r.contentWrapperLoader(),$(".collapsible").collapsible({accordion:!1}),todayMission||n.get("pendingTask"))if(n.get("pendingTask")){var a=angular.fromJson(n.get("pendingTaskDetails"));console.log("PENDING TASK"),console.log(a),e.missionTitle=a.title,e.todayMission=a.mission,e.didyouknow=a.didyouknow,e.reference=a.reference,e.taskid=a.taskid,e.taskno=a.taskno,console.log(e.reference)}else e.missionTitle=missionTitle,e.todayMission=todayMission,e.didyouknow=didyouknow,e.reference=reference,e.taskid=taskid,e.taskno=score,console.log(e.reference);else t.path("/play");e.displayDidyouknow=!1,e.displayReference=!1,e.toggleSection=function(t){"#didyouknowBtn"==t?e.displayDidyouknow&&e.scrollToSection(t):e.displayReference&&e.scrollToSection(t)},e.scrollToSection=function(e){var t=$(e);return t=t.length?t:$("[name="+this.hash.slice(1)+"]"),t.length?(console.log(t),$(".scrollable-wrapper").animate({scrollTop:t.offset().top},1e3),!1):void 0},r.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1),e.acceptMission=function(){s.acceptMission(e.user.id,e.groupid,taskid).then(function(o){n.set("pendingTask",e.taskid),e.pendingTaskDetails={title:e.missionTitle,mission:e.todayMission,didyouknow:e.didyouknow,reference:e.reference,taskno:e.taskno,taskid:e.taskid},n.set("pendingTaskDetails",angular.toJson(e.pendingTaskDetails)),t.path("/wall")},function(e){});var o=parseInt(n.get("taskCompleted"))+1;n.set("taskCompleted",o)}}),app.controller("MessageCtrl",function(e,t,o,n,s,r){e.setHeader("messages"),e.setActiveMenu("message"),e.headTitle="messages",e.headMessage="All Messages",r.contentWrapperLoader(),e.messageListInt=function(){var t=s(function(){e.messageList()},5e3)},e.messageListInt(),r.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1),e.messageList=function(){e.messages=[],"/messages"==currentRoute&&o.post("/api/service/groupmessage/getConversationList").success(function(o,n,s,r){e.messages=angular.fromJson(o),angular.forEach(e.messages,function(t,o){var n=JSON.parse(t.members);e.messages[o].members=n}),0==e.messages.length&&"/messages"==t.path()&&$(".messages").html('<div class="empty-content-message">You currently have no messages.<br> To send a message use the NEW MESSAGE buton below.</div>')}).error(function(e,t,o,n){})},e.messageList(),e.messageView=function(e,t){var o=[{id:e,full_name:t}];n.set("selectedUsers",JSON.stringify(o)),location.href="#/message/"+e},e.humanReadable=function(e){var e=moment(e).fromNow(),t=e.indexOf("in a minute");return t>-1&&(e="a few seconds ago"),e},e.openMessage=function(e){location.href="#/message/view/"+e},e.createNewConversation=function(){location.href="#/nmSelectUser"}}),app.controller("MessageLocationCtrl",function(e,t,o,n,s,r){var a=location.href.split("/");n.set("messageid",a[5]),location.href="#/messageView"}),app.controller("MessageSelectGroupCtrl",function(e,t,o,n,s){e.setHeader("Select Group"),e.setActiveMenu("message"),e.headTitle="Select Team",e.headMessage="",s.contentWrapperLoader(),o.post("/api/group/list").success(function(t,o,s,r){e.groups=t,1==t.length&&(n.set("messageGroupUser",t[0].id),location.href="#/nmSelectUser")}).error(function(e,t,o,n){}),s.removeContentWrapperLoader(),e.messageGroupUser=function(e){n.set("messageGroupUser",e),location.href="#/nmSelectUser"}}),app.controller("MessageSelectUserCtrl",function(e,t,o,n,s){e.setHeader("Select User"),e.setActiveMenu("message"),e.headTitle="Select User",s.contentWrapperLoader(),s.removeContentWrapperLoader(),e.openMessage=function(){alert("dasfds")},e.messageView=function(e,t){location.href="#/message/"+e}}),app.controller("MessageViewCtrl",function(e,t,o,n,s,r){e.setHeader("Message"),e.setActiveMenu("message"),e.headTitle="View Message",e.headMessage=n.get("messageusername"),e.selectedUsers={},e.$watch(function(){return n.get("selectedUsers")},function(t,o){e.selectedUsers={},e.selectedUsers=JSON.parse(t)});var a=0;s.contentWrapperLoader();var i=!1;conversationID=r.id,$(".setting-btn").dropdown({inDuration:300,outDuration:225,constrain_width:!1,hover:!0,gutter:0,belowOrigin:!1,alignment:"left"}),e.notificationSTT=function(){var t="false";0==e.notificationStatus?(t="true",1==e.notificationStatus):0==e.notificationStatus,o.post("/api/service/groupmessage/updateNotificationStatus",{conversationID:conversationID,st:t}).success(function(e,t,o,n){})},e.retrieveConversation=function(){"/message/view/:id"==currentRoute&&o.post("/api/service/groupmessage/retriveGroupMessage",{conversationID:conversationID}).success(function(t,o,s,r){e.messages=t.mlist,n.set("selectedUsers",t.user_list);var a=JSON.parse(t.user_list);angular.forEach(e.groupUsers,function(e,t){e.checked=!1,angular.forEach(a,function(t,o){e[0].id==t.id&&(e.checked=!0)})}),e.notificationStatus=t.status}).error(function(e,t,o,n){})},e.retrieveConversation(),setInterval(function(){e.retrieveConversation()},5e3),s.removeContentWrapperLoader(),e.showDropdown=function(){$("#settings-dropdown").toggleClass("hide "),$("#invisible-cover").toggleClass("hide ")},e.hideDropdown=function(){$("#invisible-cover").addClass("hide"),$("#settings-dropdown").addClass("hide")},e.sendMessage=function(){var t=n.get("selectedUsers"),s=e.commentnewtext;e.commentnewtext="",s&&o.post("/api/service/groupmessage/sendGroupMessage",{id:r.id,message:s,userList:t,conversationID:conversationID}).success(function(t,o,n,s){e.retrieveConversation(),e.commentnewtext="",$(".private-messages").animate({scrollTop:0},"slow"),e.retrieveConversation()})},e.humanReadable=function(e){return moment(e).fromNow()}}),app.controller("GroupMessageCtrl",function(e,t,o,n,s,r,a,i){e.setActiveMenu("message");var c=[];e.headTitle="Group Message",e.headMessage="Group Message",e.groupid=o.get("currentSelectedGroup"),e.user=o.get("user"),e.user=angular.fromJson(e.user),setInterval(function(){e.messageList(),$(".group-message-content-chat-container-chatscreen").scrollTop($(".group-message-content-chat-container-chatscreen")[0].scrollHeight)},3e3),e.init=function(){console.log(e.user);var t=new Object;t.uid=e.user.id,t.name=e.user.firstname+" "+e.user.lastname,c.push(t),e.avtivemembers=angular.fromJson(JSON.stringify(c)),o.get("conversationid")||a.post("/api/groupMessage/initRoomData",{gid:e.groupid}).success(function(e,t,n,s){o.set("conversationid",e.roomid),o.set("conversationtitle",e.title)}),e.title=o.get("conversationtitle")},e.init(),e.memberList=function(){a.post("/api/groupMessage/memberList",{gid:e.groupid}).success(function(t,o,n,s){e.members=angular.fromJson(t);var r="";jQuery.each(e.members,function(t,o){this[0].id==e.user.id&&(r=this[0].id)})}).error(function(e,t,o,n){})},e.memberList(),e.addMemberToList=function(t,n){var s=!1;if(console.log(c),console.log("++++++"),jQuery.each(c,function(e,t){console.log(this.name),this.name==n&&(s=!0)}),0==s){var r=new Object;r.uid=t,r.name=n,$("#group-list-item-number-"+t).css("background-color","#1B4C63"),c.push(r),e.avtivemembers=angular.fromJson(JSON.stringify(c)),$(".num-of-members").html(c.length)}a.post("/api/groupMessage/newMember",{roomid:o.get("conversationid"),newmemberid:r.uid,newmemberfname:r.name,userList:c}).success(function(t,o,n,s){e.messageList()})},e.removeMember=function(t,n){if(c.length<=1)alert("Error !");else{var s=[];$("#group-list-item-number-"+t).css("background-color",""),$("#group-list-member-"+t).remove(),jQuery.each(c,function(e,o){this.uid!=t&&s.push(this)}),c=s,e.avtivemembers=angular.fromJson(JSON.stringify(c)),$(".num-of-members").html(c.length)}a.post("/api/groupMessage/removeMember",{roomid:o.get("conversationid"),newmemberid:t,newmemberfname:n,userList:c}).success(function(t,o,n,s){e.messageList()})},e.sendMessage=function(){var t=e.commentnewtext;t&&a.post("/api/groupMessage/send",{id:o.get("conversationid"),message:t,userList:c}).success(function(t,o,n,s){e.commentnewtext="",e.messageList()})},e.messageList=function(){a.post("/api/groupMessage/messageList",{id:o.get("conversationid")}).success(function(t,o,n,s){e.messages=t,e.getTheCurrentUserLIst()})},e.messageList(),e.humanReadable=function(e){return moment(e).fromNow()},e.getTheCurrentUserLIst=function(){a.post("/api/groupMessage/getTheCurrentUserLIst",{id:o.get("conversationid")}).success(function(t,o,n,s){e.avtivemembers=angular.fromJson(t.userlist),console.log("+++++"+e.avtivemembers);var r="";jQuery.each(e.avtivemembers,function(e,t){$("#group-list-item-number-"+t.uid).css("background-color","#1B4C63")}),c=e.avtivemembers,$(".num-of-members").html(c.length)})},e.leaveChat=function(){a.post("/api/groupMessage/leaveChat",{id:o.get("conversationid")}).success(function(t,o,n,s){e.avtivemembers=angular.fromJson(t),c=e.avtivemembers,location.href="/#/groupMessageList"})}}),app.controller("WallCtrl",function(e,t,o,n,s,r,a,i,c,l,p){e.headTitle="Wall Posts",e.posts="",e.user=o.get("user"),e.displayLoading=1,e.loadingData=!1,e.feedbackPopdown=0,e.pendingTask=o.get("pendingTask");var u=0;e.currentUser=angular.fromJson(e.user),e.setHeader("Wall"),e.setActiveMenu("wall"),100==o.get("progressPercentage")&&$(".button-gre").html("GOAL COMPLETED!"),e.testYoutube=function(e){var t=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/ytscreeningroom\?v=|\/feeds\/api\/videos\/|\/user\S*[^\w\-\s]|\S*[^\w\-\s]))([\w\-]{11})[?=&+%\w-]*/gi;return t.test(e)},e.displayPosts=function(){if(i.contentWrapperLoader(),c.postid){var o=t({method:"POST",url:"/api/group/postByID",data:{postid:c.postid,groupid:e.currentGroup}});o.success(function(t){$("#team-posts .loading-spinner").hide(),e.posts=t,e.displayLoading=0})}else{var o=t({method:"POST",url:"/api/group/posts",data:{groupid:e.currentGroup}});o.success(function(o){if(console.log(o),$("#team-posts .loading-spinner").hide(),o.length>0){e.posts=o;for(var n in o)if(o[n].status&&e.testYoutube(o[n].status)){if(o[n].status.indexOf("v=")>=0)var s=o[n].status.split("v=")[1];else var s=o[n].status.split(".be/")[1];e.posts[n].status="<iframe width='560' height='315' class='youtube-player' type='text/html' src='https://www.youtube.com/embed/"+s+"' frameborder='0' allowfullscreen></iframe>"}var r=t({method:"POST",url:"/api/group/countPosts",data:{groupid:e.currentGroup}});r.success(function(t){e.totalPosts=t})}else $(".team-posts").html('<div class="empty-content-message">You currently have no wall posts.<br> To create a new post use the NEW POST buton below.</div>');e.displayLoading=0})}i.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1)},e.likePost=function(e){var o={postid:e.id,type:"like"};if(e.like){o.type="unlike";var n=e.likeCount--}else var n=e.likeCount++;var s=t.post("/api/user/post/like",o);e.like=!e.like},e.humanReadable=function(e){var e=moment(e).fromNow(),t=e.indexOf("in a minute");return t>-1&&(e="a few seconds ago"),e},e.showDropdown=function(e){u=e,$("#dropdown-"+e).toggleClass("hide "),$("#invisible-cover").toggleClass("hide ")},e.hideDropdown=function(){$("#invisible-cover").addClass("hide"),$("#dropdown-"+u).addClass("hide")},e.zoomImage=function(e){$(".popup-inactive").toggleClass("popup-inactive popup-active"),$("#image-spinner").show();var t=$("#full-image");t.html(e);var o=t.width(),n=t.height();setTimeout(function(){var e=t.children(),s=e.width(),r=e.height();o>s&&n>r?(t.addClass("image-normal"),e.addClass("size-auto")):s>=o&&r>=n?s>=r?e.css("width","100%"):e.css("height","100%"):(o>=s?e.addClass("width-auto"):e.addClass("width-full"),n>=r?e.addClass("height-auto"):e.addClass("height-full")),$("#image-spinner").hide(),$("#full-image img").show()},1e3)},e.$on("$viewContentLoaded",function(){setTimeout(function(){e.displayPosts()},1e3),o.get("recentMissionCompleted")&&(e.feedbackPopdown=1,o.unset("recentMissionCompleted"))}),e.report=function(e,t,o){l.newDropdown("reportPostConfirmation",12e3,"Tap here to report the post! "),postReportIDs.post_id=e,postReportIDs.user_id=t,postReportIDs.group_id=o,console.log(postReportIDs)},e.focusComment=function(e){$("#post-"+e+" .comment-new input").focus()},e.reportComment=function(e,t,o,n){l.newDropdown("reportCommentConfirmation",12e3,"Tap here to report the comment!  "),commentReportIDs.post_id=e,commentReportIDs.comment_id=t,commentReportIDs.user_id=o,commentReportIDs.group_id=n,console.log(commentReportIDs)},e.loadMoreData=function(){if(!c.postid){e.displayLoading=!0;var o={groupid:e.currentGroup,limitfrom:e.posts.length};e.loadingData===!1&&(e.loadingData=!0,t.post("/api/group/posts",o).then(function(t){angular.forEach(t.data,function(t,o){if(t.status&&e.testYoutube(t.status)){if(t.status.indexOf("v=")>=0)var n=t.status.split("v=")[1];else var n=t.status.split(".be/")[1];t.status="<iframe width='560' height='315' class='youtube-player' type='text/html' src='https://www.youtube.com/embed/"+n+"' frameborder='0' allowfullscreen></iframe>"}e.posts.push(t)}),e.loadingData=!1,e.displayLoading=!1}))}},e.addComment=function(t,o){if(t.preventDefault(),console.log(o.activecomment),""!=o.activecomment){var s=angular.fromJson(e.user),r={comment:o.activecomment,user:s,time:moment().fromNow(),user_id:s.id,post_id:o.id};o.comments.push(r),o.activecomment="",n.addComment(r)}o.activecomment=""},e.closePopup=function(){e.feedbackPopdown=0,o.unset("recentMissionCompleted"),r.reload()},e.editPost=function(e){o.set("postedit.id",e),location.href="#/editpost"},e.toggleText=function(e){$("#post-mission-"+e).toggleClass("open closed").toggleClass("orange "),$("#post-mission-"+e).find(".mission-content").slideToggle(),$("#post-mission-"+e).find(".mission-title .icon").toggleClass("plus minus")}}),app.factory("postFactory",function(e){return{getPosts:e({
method:"POST"})}}),app.controller("PostsCtrl",function(e,t,o,n,s,r,a,i){e.headTitle="posts",e.headMessage="Add a new post",e.hideFileUpload=!0,e.user=angular.fromJson(i.get("user")),e.showPostAs=!1,e.groupid=i.get("currentSelectedGroup"),e.pendingTaskDetails=angular.fromJson(i.get("pendingTaskDetails")),e.pendingTask=i.get("pendingTask"),e.imageSrc="",e.finalTask="",e.posting=!1,$(document).ready(function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("android")>-1;t&&"true"==usingUniWebView&&$(".post-new .status_text").focusin(function(){$(this).css("height","50%")}).focusout(function(){$(this).css("height","80%")})}),e.moods=[{name:"<img src='/images/icon/emoji/fantastic.png' /> <span class='mood-title'>Fantastic</span>",code:5},{name:"<img src='/images/icon/emoji/pretty-good.png' /> <span class='mood-title'>Pretty Good</span>",code:4},{name:"<img src='/images/icon/emoji/okey.png' /> <span class='mood-title'>Okay</span>",code:3},{name:"<img src='/images/icon/emoji/not-great.png' />  <span class='mood-title'>Not Great</span>",code:2},{name:"<img src='/images/icon/emoji/terrible.png' /> <span class='mood-title'>Terrible</span>",code:1}],$("#postForm select").material_select(),t.contentWrapperLoader(),n.post("/api/mission/detectLastMission",{taskid:e.pendingTask,groupid:e.groupid}).success(function(t,o,n,s){e.finalTask=t}).error(function(e,t,o,n){}),t.removeContentWrapperLoader(),e.post={status_text:"",status_file:"",type:e.pendingTask?"mission":"general",display_mission:e.pendingTask?!0:!1,all_teams:!1,mood:""},e.modalBox=function(){$("#post-image-form").click()},e.toggleDisplayMission=function(){"mission"==e.post.type?e.post.display_mission=!0:e.post.display_mission=!1},e.showPostAsMenu=function(){},e.param={},e.file="",e.$on("fileSelected",function(t,o){e.$apply(function(){e.file=o.file,e.post.status_file=o.file;var t=new FileReader;t.onload=function(t){e.imageSrc=t.target.result,e.$apply()},t.readAsDataURL(o.file)})}),e.addPost=function(c){console.log(e.post),t.ajaxLoader(),e.post.userid=e.user.id,e.post.groupid=e.groupid,e.post.taskid=e.pendingTask?e.pendingTask:0;var l=e.post.status_text.replace(/(\r\n|\n|\r)/gm,"");s.log(e.post);var p=/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/;e.post.status_text?e.post.status_text&&l.search(p)>=0?(a.newDropdown("warning",5e3,"This post does not support Vimeo"),t.removeAjaxLoader()):(e.posting=!0,e.post.mood&&(e.post.mood=e.post.mood.code),r.addPost(e.post).then(function(s){e.posting=!1,"mission"==e.post.type&&(i.unset("pendingTask"),i.unset("pendingTaskDetails"),i.set("recentMissionCompleted",1),i.set("lastCompletedMission",e.post.taskid),n({url:"/api/group/list",method:"POST"}).then(function(e){i.set("numOfDaysPassed",e.data[0].daysPassed)})),e.finalTask==e.post.taskid&&e.post.mission_completed?(location.href="#/wall",setTimeout(function(){location.href="#/postsurveyintro"},3e3)):o.path("/wall"),t.removeAjaxLoader()},function(e){console.log("An upload error occured writng post"),console.log(e),appViews.progressError("An upload error has occurred.<br/>Tap to continue.")})):(a.newDropdown("warning",5e3,"Please write a message"),t.removeAjaxLoader())},e.report=function(){alert("sss")},e.switchAllteams=function(){e.post.all_teams?e.post.all_teams=!1:(e.post.all_teams=!0,e.post["private"]=!1)},e.file_changed=function(e,t){var o=document.querySelector("input[type=file]").files[0],n=o.type,s="";if(n.indexOf("image")>=0){var r=new FileReader;o&&r.readAsDataURL(o),r.onloadend=function(){$(".uploaded-image-source").attr("src",r.result),$(".uploaded-image-source").css("display","block"),$(".uploaded-images").css("display","block"),s=r.result}}else a.newDropdown("warning",5e3,"Please make sure file is picture!")},e.removePreviewImage=function(){$(".uploaded-image-source").attr("src",""),$(".uploaded-image-source").css("display","none"),$(".uploaded-images").css("display","none");var t=$(".status_file");t.replaceWith(t.val("").clone(!0)),e.post.status_file=""}}),app.controller("PostEditCtrl",function(e,t,o,n,s,r,a,i,c){t.contentWrapperLoader(),e.headTitle="posts",e.headMessage="Edit a post",e.hideFileUpload=!0,e.user=angular.fromJson(c.get("user")),e.showPostAs=!1,e.groupid=c.get("currentSelectedGroup"),e.pendingTaskDetails=angular.fromJson(c.get("pendingTaskDetails")),e.pendingTask=c.get("pendingTask"),e.imageSrc="",e.finalTask="";var l="";$("#editForm select").material_select(),n.post("/api/post/fetchPostByID",{postid:c.get("postedit.id")}).success(function(o,n,s,r){e.post=o,console.log(o),1==o.mission_completed&&(e.post.type="mission"),1==o.general&&(e.post.type="general"),1==o["private"]&&(e.post.type="note"),""!=o.image&&($(".uploaded-image-source").attr("src",o.image),$(".uploaded-image-source").css("display","block"),$(".uploaded-images").css("display","block")),t.removeContentWrapperLoader()}).error(function(e,t,o,n){alert("An error ocurred !, please try again !")}),e.file_changed=function(e,t){var o=document.querySelector("input[type=file]").files[0],n=o.type;if(n.indexOf("image")>=0){var s=new FileReader;o&&s.readAsDataURL(o),s.onloadend=function(){$(".uploaded-image-source").attr("src",s.result),$(".uploaded-image-source").css("display","block"),$(".uploaded-images").css("display","block"),l=s.result}}else a.newDropdown("warning",5e3,"Please make sure file is picture!"),$(".status_file").remove(),$(".fileUpload").append('<input type="file"  onchange="angular.element(this).scope().file_changed(this)" class="status_file" data-file="post.status_file" upload-file ng-hide="hideFileUpload=0" />')},e.removePreviewImage=function(){$(".uploaded-image-source").attr("src",""),$(".uploaded-image-source").css("display","none"),$(".uploaded-images").css("display","none");var t=$(".status_file");t.replaceWith(t.val("").clone(!0)),e.post.status_file="",e.post.imgContent=""},e.report=function(){alert("sss")},e.switchAllteams=function(){e.post.all_teams?e.post.all_teams=!1:(e.post.all_teams=!0,e.post["private"]=!1)},e.editPost=function(o){console.log("ADD LOADER"),t.ajaxLoader();var n=e.post.status.replace(/(\r\n|\n|\r)/gm,""),s=/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/;if(e.post.status)if(e.post.status&&n.search(s)>=0)a.newDropdown("warning",5e3,"This post does not support Vimeo"),t.removeAjaxLoader();else{e.post.id=c.get("postedit.id");var r=document.querySelector("input[type=file]").files[0];console.log(r),i.http({method:"POST",url:"/api/post/submitEditedContent",headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;return t.append("post",angular.toJson(e.postData)),t.append("file",e.file),t},data:{postData:e.post,file:r}}).success(function(e){"OK"==e&&(location.href="#/wall",t.removeAjaxLoader())}).progress(function(e){appViews.updateProgress(parseInt(100*e.loaded/e.total))}).error(function(e,t,o,n){console.log("An error occured writng post"),console.log(e),appViews.progressError("An error has occurred.<br/>Tap to continue.")}),t.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1)}else a.newDropdown("warning",5e3,"Please write a message"),t.removeAjaxLoader()}}),app.controller("SurveyCtrl",function(e,t,o,n,s,r,a){e.groupid=r.get("currentSelectedGroup"),e.presurveyid=angular.fromJson(r.get("currentSelectedGroupDetails")).survey,e.postsurveyid=angular.fromJson(r.get("currentSelectedGroupDetails")).postsurvey,e.survey={type:"pre",group:parseInt(e.groupid),surveyid:0},e.markSurveyCompleted=function(t){"pre"===t?(e.survey.surveyid=e.presurveyid,r.set("preSurveyCompleted","1"),a.markSurveyComplete(e.survey),n.path("/main")):"post"===t&&(e.survey.type="post",e.survey.surveyid=e.postsurveyid,r.set("postSurveyCompleted","1"),a.markSurveyComplete(e.survey))}}),app.controller("SupportTicketCtrl",function(e,t,o,n,s,r,a,i){e.recentTaskCompleted="",e.headTitle="Support",e.errorMessage="",e.ticket={},e.setHeader("Contact Support"),e.setActiveMenu("none"),e.validateEmail=function(e){var t=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},e.sendTicket=function(){e.errorMessage="","true"==o.get("authenticated")?e.ticket.type?e.ticket.feedback||i.newDropdown("warning",5e3,"Please write a message"):i.newDropdown("warning",5e3,"Please select a subject"):e.ticket.name?e.ticket.email&&e.validateEmail(e.ticket.email)?void 0==e.ticket.type?e.errorMessage="Please select subject":e.ticket.feedback||(e.errorMessage="Please enter message"):e.errorMessage="Please enter a valid email ":e.errorMessage="Please enter name",""==e.errorMessage&&r.post("/api/global/supportFeedback",{name:e.ticket.name,email:e.ticket.email,type:e.ticket.type,feedback:e.ticket.feedback}).success(function(e,n,s,r){a.removeAjaxLoader(),"true"==o.get("authenticated")?t.path("/main"):t.path("/login"),i.newDropdown("notification",4e3,"Feedback sent")})}}),app.controller("HowtoCtrl",function(e,t,o){e.headTitle="OAR 21",e.headMessage="How to play",o.contentWrapperLoader(),e.setHeader("How To Play"),e.setActiveMenu("none"),$(".collapsible").collapsible({accordion:!0}),e.HowTo=function(e,t){var o=e,n=t,s=7,r=!1,a=function(){o.addEventListener("timeupdate",function(){i()},!0)};a();var i=function(){var e=100;o.currentTime<10?c(0):o.currentTime<20?c(e):o.currentTime<30?c(2*e):o.currentTime<40?c(3*e):o.currentTime<50?c(4*e):o.currentTime<60?c(5*e):o.currentTime<70&&c(6*e)},c=function(e){r||(r=!0,n.animate({marginLeft:"-"+e+"%"},700,function(){r=!1}))}},e.$on("$viewContentLoaded",function(){var t=new e.HowTo($(".how-to-play-video")[0],$(".how-to-info"))}),o.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1)}),app.controller("NotificationAdminCtrl",function(e,t,o,n,s,r,a,i){e.headTitle="Account",e.headMessage="Notification settings",e.setHeader("Notification Settings"),e.setActiveMenu("none"),a.contentWrapperLoader(),o.post("/api/notification/getNotification").success(function(t,o,n,s){"0"==t.push_notification?(e.pushnotificationcb=!1,r.set("pushnotificationcb",!1)):(e.pushnotificationcb=!0,r.set("pushnotificationcb",!0)),"0"==t.notification?(e.notificationcb=!1,r.set("liveAppNotificationSession",!1)):(e.notificationcb=!0,r.set("liveAppNotificationSession",!0)),"0"==t.notification_email?e.emailnotificationcb=!1:e.emailnotificationcb=!0,"0"==t.notification_web?e.webnotificationcb=!1:e.webnotificationcb=!0}),a.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1),e.notificationcbFunction=function(){var t=1;t=1==e.notificationcb?0:1,o.post("/api/notification/setNotification",{type:"normal",data:t}).success(function(e,t,o,n){"true"==r.get("liveAppNotificationSession")?r.set("liveAppNotificationSession",!1):r.set("liveAppNotificationSession",!0)}).error(function(e,t,o,n){})},e.emailnotificationcbFnction=function(){var t=1;t=1==e.emailnotificationcb?0:1,o.post("/api/notification/setNotification",{type:"email",data:t}).success(function(e,t,o,n){}).error(function(e,t,o,n){})},e.pushnotificationcbFnction=function(){var t=1;t=1==e.pushnotificationcb?0:1,o.post("/api/notification/setNotification",{type:"push",data:t}).success(function(e,t,o,n){})},e.webnotificationcbFunction=function(){var t=1;t=1==e.webnotificationcb?0:1,o.post("/api/notification/setNotification",{type:"web",data:t}).success(function(e,t,o,n){}).error(function(e,t,o,n){})}}),app.controller("AccountSettingsCtrl",function(e,t,o,n,s,r,a,i,c,l){e.headTitle="Account",e.headMessage="Account settings",r.contentWrapperLoader(),e.setHeader("User Settings"),e.setActiveMenu("none");var p=JSON.parse(i.get("user")),u=1e4,d=3e4;e.randomIMG=Math.floor(Math.random()*(d-u+1))+u,e.userAvatar=p.picture,$("#resetAvatar").css("display","none");var m="",g="";e.profile={username:p.username,firstname:p.firstname,lastname:p.lastname,email:p.email,screenname:p.screenhandle,state:p.state},e.populateImageContent=function(e){},e.resetAvatar=function(){$("#avatar").attr("src",p.picture+"?"+e.randomIMG),$("#profile img").attr("src",p.picture+"?"+e.randomIMG),$("#resetAvatar").css("display","none");var t=$("#fileInp");t.replaceWith(t.val("").clone(!0)),m="",g=""},e.file_changed=function(e,t){var o=document.querySelector("input[type=file]").files[0];g=o.type;var n=new FileReader;o&&n.readAsDataURL(o),n.onloadend=function(){var e=$("#avatar").attr("src",n.result);$("#profile img").attr("src",n.result),m=n.result},$("#resetAvatar").css("display","block")};var f=function(e){return $.param(e)};e.updateUser=function(o){var n=!0,s="";if(e.errorMessage="",e.profile.firstname)if(e.profile.lastname)if(e.profile.email)if(e.profile.password&&!e.profile.confirmpassword)e.errorMessage="Please confirm new password!";else if($.trim(e.profile.password)!=$.trim(e.profile.confirmpassword))e.errorMessage="Passwords did not match!";else{r.ajaxLoader();var i=e.fileInput;e.profile={fileType:g,firstname:e.profile.firstname,lastname:e.profile.lastname,email:e.profile.email,password:e.profile.password};var p=document.querySelector("input[type=file]").files[0];l.http({method:"POST",url:"api/user/update",headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;return t.append("post",angular.toJson(e.postData)),t.append("file",e.file),t},data:{postData:e.profile,file:p}}).success(function(e){if("OK"==e){c.newDropdown("notification",2e3,"Account settings updated"),c.newDropdown("notification",5e3,"Please log in"),$("#resetAvatar").css("display","none");var o=$("#fileInp");o.replaceWith(o.val("").clone(!0))}else c.newDropdown("notification",5e3,e);r.removeAjaxLoader(),a.logout(),t.path("/login")}).progress(function(e){appViews.updateProgress(parseInt(100*e.loaded/e.total))})}else e.errorMessage="Please enter email!";else e.errorMessage="Please enter last name!";else e.errorMessage="Please enter first name!"},r.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1)}),app.controller("NotificationCtrl",function(e,t,o,n,s,r,a,i){e.headTitle="notification center",e.headMessage="Notification Center",e.setHeader("Notifications"),e.setActiveMenu("notification"),a.contentWrapperLoader(),o.post("/api/notification/getNotificationList").success(function(t,o,n,s){e.notifications=angular.fromJson(t),0==e.notifications.length&&$(".notifications").append('<div class="empty-content-message">You currently have no notifications</div>')}).error(function(e,t,o,n){}),a.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1),e.filterNewRoller=function(t){e.unsetIcons(),$("#filter-icon-new-roller").attr("src","images/filter-new-roller-active.png")},e.filterLike=function(t){e.unsetIcons(),$("#filter-icon-like").attr("src","images/icon/like-active.png")},e.filterComment=function(t){e.unsetIcons(),$("#filter-icon-comment").attr("src","images/icon/comment-active.png")},e.humanReadable=function(e){return moment(e).fromNow()},e.filterMsg=function(t){e.unsetIcons(),$("#filter-icon-message").attr("src","images/icon/nav/message-active.png")},e.unsetIcons=function(){$("#filter-icon-like").attr("src","images/icon/like-inactive.png"),$("#filter-icon-comment").attr("src","images/icon/comment-inactive.png"),$("#filter-icon-message").attr("src","images/icon/nav/message-inactive.png")},e.redirectToTarget=function(e,t,o){"newgroupmessage"==e&&(location.href="#/message/view/"+t),"message"==e&&(location.href="#/message/"+o),"newlike"==e&&(location.href="#/wall/"+t),("newcomment"==e||"newcommentother"==e)&&(location.href="#/wall/"+t)}}),app.controller("SupportCtrl",function(e,t,o,n,s,r){e.headTitle="Support",e.headMessage="FAQ & Support",e.setHeader("FAQ"),e.setActiveMenu("none"),$(".collapsible").collapsible({accordion:!0}),r.contentWrapperLoader(),r.removeContentWrapperLoader()}),app.controller("LegalCtrl",function(e,t,o,n,s){}),app.controller("HowtoOutsideCtrl",function(e,t,o,n,s){}),app.controller("MissionCompletedCtrl",function(e,t,o,n,s,r){e.headTitle="Play",e.headMessage="All missions accepted"}),app.controller("GroupMessageListCtrl",function(e,t,o,n,s,r){e.setHeader("messages"),e.setActiveMenu("message"),e.headTitle="conversations",e.headMessage="All Conversations",r.contentWrapperLoader(),e.messageList=function(){o.post("/api/groupMessage/searchByUserID").success(function(o,n,s,r){e.messages=angular.fromJson(o),0==e.messages.length&&"/groupMessageList"==t.path()&&$(".messages").html('<div class="empty-content-message">You currently have no conversations.<br> To create a conversation use the NEW CONVERSATION buton below.</div>')}).error(function(e,t,o,n){})},e.messageList(),r.removeContentWrapperLoader(),e.humanReadable=function(e){return moment(e).fromNow()},e.groupMessageView=function(e,t){n.set("conversationid",e),n.set("conversationtitle",t),location.href="/#/groupmessage/"+e},e.navigateWithCondition=function(e){n.set("conversationid",""),n.set("conversationtitle",""),location.href="/#/groupmessage"}}),app.controller("postNewController",function(e,t,o,n,s,r){alert("al")}),app.controller("PostAsCtrl",function(e,t,o,n,s,r,a){e.asPostText=a.posttext,$("#image-post-container").attr("src",postAsImg)}),app.controller("PreSurveyCtrl",function(e,t,o,n,s,r,a){function i(e){var t={},o,n,s=[],r="",a=String.fromCharCode,i=[[65,91],[97,123],[48,58],[43,44],[47,48]];for(var c in i)for(o=i[c][0];o<i[c][1];o++)s.push(a(o));for(o=0;64>o;o++)t[s[o]]=o;for(o=0;o<e.length;o+=72){var l=0,p,u,d=0,m=e.substring(o,o+72);for(u=0;u<m.length;u++)for(p=t[m.charAt(u)],l=(l<<6)+p,d+=6;d>=8;)r+=a((l>>>(d-=8))%256)}return r}e.headTitle="pre survey",e.headMessage=angular.fromJson(o.get("currentSelectedGroupDetails")).name,e.selectedGroupId=angular.fromJson(o.get("currentSelectedGroupDetails")).id,e.userid=angular.fromJson(o.get("user")).id,e.groupDetails=angular.fromJson(o.get("currentSelectedGroupDetails"));var c=0,l=0,p=!1,u=[];s.contentWrapperLoader(),console.log(e.groupDetails.thumbnail),e.logo=i(e.groupDetails.thumbnail),n.post("/api/survey/getSurveyList",{type:"pre",groupid:e.selectedGroupId}).success(function(t,o,s,r){e.questions=t,c=t.length,0==c?(e.headTitle="TEAM",e.template="/templates/widgets/pre-survey-without-content.html",n.post("/api/user/survey/completePreSurvey",{groupid:e.selectedGroupId,surveyid:10}).success(function(e,t,o,n){})):e.template="/templates/widgets/pre-survey-with-content.html"}),s.removeContentWrapperLoader(),e.presurveySwitch=function(){0==c?t.path("/main"):t.path("/presurvey")},e.saveResponse=function(){s.ajaxLoader(),p?($.ajax({url:"/api/survey/saveResponse",type:"post",dataType:"json",data:$("form#presurveyform").serialize(),success:function(e){o.set("preSurveyCompleted","1"),t.path("/main")}}),s.removeAjaxLoader(),r.newDropdown("notification",5e3,"Pre survey completed")):(r.newDropdown("warning",3e3,"Please answer all questions"),s.removeAjaxLoader())},e.optionSelect=function(e){for(var t=!1,o=0;o<u.length;o++){var n=u[o];n==e&&(t=!0)}t||u.push(e),u.length>=c&&(p=!0),l++},e.$on("$viewContentLoaded",function(e){})}),app.controller("PostSurveyCtrl",function(e,t,o,n,s,r,a){e.headTitle="post survey",e.headMessage=angular.fromJson(o.get("currentSelectedGroupDetails")).name,e.selectedGroupId=angular.fromJson(o.get("currentSelectedGroupDetails")).id,e.userid=angular.fromJson(o.get("user")).id,s.contentWrapperLoader();var i=0,c=0,l=!1,p=[];n({url:"api/global/getProgress",method:"POST",data:{groupid:e.selectedGroupId}}).then(function(e){o.set("progressPercentage",e.data)}),n.post("/api/survey/getSurveyList",{type:"post",groupid:e.selectedGroupId}).success(function(t,o,s,r){e.questions=t,i=t.length,0==i?(e.headTitle="TEAM",e.template="/templates/widgets/post-survey-without-content.html",n.post("/api/user/survey/completePostSurvey",{groupid:e.selectedGroupId,surveyid:10}).success(function(e,t,o,n){})):e.template="/templates/widgets/post-survey-with-content.html"}),s.removeContentWrapperLoader(),e.postsurveySwitch=function(){0==i?t.path("/main"):t.path("/postsurvey")},e.saveResponse=function(){s.ajaxLoader(),l?($.ajax({url:"/api/survey/saveResponse",type:"post",dataType:"json",data:$("form#postsurveyform").serialize(),success:function(e){o.set("postSurveyCompleted","1"),t.path("/main")}}),s.removeAjaxLoader(),r.newDropdown("notification",4e3,"Post survey completed"),r.newDropdown("notification",4e3,"Fantastic - goal completed!")):(r.newDropdown("warning",3e3,"Please answer all questions"),s.removeAjaxLoader())},e.optionSelect=function(e){for(var t=!1,o=0;o<p.length;o++){var n=p[o];n==e&&(t=!0)}t||p.push(e),p.length>=i&&(l=!0),c++},e.$on("$viewContentLoaded",function(){})}),angular.module("ngUpload",[]).directive("uploadSubmit",["$parse",function(e){function t(e,o){e=angular.element(e);var n=e.parent();return o=o.toLowerCase(),n&&n[0].tagName.toLowerCase()===o?n:n?t(n,o):null}return{restrict:"AC",link:function(e,o,n){o.bind("click",function(e){if(e&&(e.preventDefault(),e.stopPropagation()),!o.attr("disabled")){var n=t(o,"form");n.triggerHandler("submit"),n[0].submit()}})}}}]).directive("ngUpload",["$log","$parse","$document",function(e,t,o){function n(e){var t=o.find("head"),n;return angular.forEach(t.find("meta"),function(t){t.getAttribute("name")===e&&(n=t)}),angular.element(n)}var s=1;return{restrict:"AC",link:function(o,r,a){function i(e){o.$isUploading=e}function c(){alert("UPLAOD DONE"),d.unbind("load"),o.$$phase?i(!1):o.$apply(function(){i(!1)});var t=(d[0].contentDocument||d[0].contentWindow.document).body,n;try{n=angular.fromJson(t.innerText||t.textContent)}catch(s){n=t.innerHTML,e.warn("Response is not valid JSON")}o.$$phase?p(o,{content:n}):o.$apply(function(){p(o,{content:n})})}s++;var l={},p=a.ngUpload?t(a.ngUpload):angular.noop,u=a.ngUploadLoading?t(a.ngUploadLoading):null;a.hasOwnProperty("uploadOptionsConvertHidden")&&(l.convertHidden="false"!=a.uploadOptionsConvertHidden),a.hasOwnProperty("uploadOptionsEnableRailsCsrf")&&(l.enableRailsCsrf="false"!=a.uploadOptionsEnableRailsCsrf),a.hasOwnProperty("uploadOptionsBeforeSubmit")&&(l.beforeSubmit=t(a.uploadOptionsBeforeSubmit)),r.attr({target:"upload-iframe-"+s,method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});var d=angular.element('<iframe name="upload-iframe-'+s+'" border="0" width="0" height="0" style="width:0px;height:0px;border:none;display:none">');if(l.enableRailsCsrf){var m=angular.element("<input />");m.attr("class","upload-csrf-token"),m.attr("type","hidden"),m.attr("name",n("csrf-param").attr("content")),m.val(n("csrf-token").attr("content")),r.append(m)}r.after(d),i(!1),r.bind("submit",function g(){var e=o[a.name];return e&&e.$invalid?!1:l.beforeSubmit&&0==l.beforeSubmit(o,{})?!1:(d.bind("load",c),l.convertHidden&&angular.forEach(r.find("input"),function(e){var t=angular.element(e);t.attr("ng-model")&&t.attr("type")&&"hidden"==t.attr("type")&&t.attr("value",o.$eval(t.attr("ng-model")))}),void(o.$$phase?(u&&u(o),i(!0)):o.$apply(function(){u&&u(o),i(!0)})))})}}}]),app.service("AuthenticationService",function(e,t,o,n,s,r){var a=function(e){o.set("authenticated",!0),o.set("user",JSON.stringify(e)),usingUniWebView=e.isOnApp,1==e.notification?1==o.get("liveAppNotificationSession"):0==o.get("liveAppNotificationSession"),o.set("moodCheck",!0)},i=function(){var e=o.get("notificationType");o.clearAll(),o.set("notificationType",e)},c=function(e){"Your account has been suspended"==e?r.newDropdown("notification",5e3,e.flash):r.newDropdown("warning",5e3,e.flash),s.removeAjaxLoader()};return{login:function(t){var o=e.post("/api/auth/login",t);return o.success(a),o.error(c),o},logout:function(){var t=e.get("/api/auth/logout");return t.success(i),t},isLoggedIn:function(){return o.get("authenticated")}}}),app.factory("globalAppNotification",function(e){return{callNotification:function(t,o,n){var s="sent you a message";"newgroupmessage"==o&&(s="sent you a group message"),"newlike"==o&&(s="likes your post"),"newcomment"==o&&(s="has commented on your post"),"newcommentother"==o&&(s="has commented on a post you commented on"),"newgroupmember"==o&&(s="has joined your team"),"missionpending"==o&&(s="have one mission pending"),"missionpending"!=o&&e.newDropdown("notification",5e3,t+" "+s,o,n)},webNotification:function(e){if("Notification"in window)if("granted"===Notification.permission)var t=new Notification(e);else Notification.requestPermission(function(t){if("granted"===t)var o=new Notification(e)});else alert("This browser does not support desktop notification")}}}),app.factory("requestNotificationService",function(e,t,o){var n=0,s=0;return{notification:function(){e.post("/api/global/notificationNum").success(function(e,r,a,i){console.log("Notification Data"),console.log(e),"false"!=e?($(".notification-alert").css("display","block"),$("#side-nav-notification-number").css("display","block")):($(".notification-alert").css("display","none"),$("#side-nav-notification-number").css("display","none")),e.count>10?($(".notification-alert").html("10+"),$("#side-nav-notification-number").html("10+")):($(".notification-alert").html(e.count),$("#side-nav-notification-number").html(e.count));var c=JSON.parse(t.get("user"));"true"==t.get("liveAppNotificationSession")&&("false"==e?(s=1,$("#side-nav-notification-number").css("display","none"),$("#side-nav-message-number").css("display","none")):(1==e.count&&1==s&&1!=n&&o.callNotification(e.user[0].firstname+" "+e.user[0].lastname,e.type,e.source_id),e.count>n&&0!=n&&("message"==e.type?o.callNotification(e.user[0].firstname+" "+e.user[0].lastname,e.type,e.source_user_id):o.callNotification(e.user[0].firstname+" "+e.user[0].lastname,e.type,e.source_id),n=0))),n=e.count})}}}),app.service("dropdownService",function(e,t,o,n,s,r,a){var i=[],c=null,l=null,p,u,d=4e6,m="",g=0,f=this.newDropdown=function(e,t,n,s,r){var a;switch(m=e,e){case"notification":var c="";switch(s){case"message":c="/#/message/"+r;break;case"newgroupmessage":c="/#/message/view/"+r;break;case"newlike":case"newcomment":case"newcommentother":c="/#/wall/"+r}a="<a href='"+c+"'><div class='popdown notification-green'><div class='notification-msg'><h4>"+n+"</h4></div></div></a>";break;case"warning":a='<div class="popdown warning-red"><div class="notification-msg"><h4>'+n+"</h4></div></div>";break;case"emotion":a='<div class="popdown container" id="emoicon"><div class="notification-type"><h3>How are you feeling?</h3></div><div class="notification-msg"><a href="#/main/mood/1"><div class="emoji-mood-container"><div class="mood-emoji emoji-5">&nbsp;</div><div class="mood-description"><p>Terrible</p></div></div></a><a href="#/main/mood/2"><div class="emoji-mood-container"><div class="mood-emoji emoji-4">&nbsp;</div><div class="mood-description"><p>Not Great</p></div></div></a><a href="#/main/mood/3"><div class="emoji-mood-container"><div class="mood-emoji emoji-3">&nbsp;</div><div class="mood-description"><p>Okay</p></div></div></a><a href="#/main/mood/4"><div class="emoji-mood-container"><div class="mood-emoji emoji-2">&nbsp;</div><div class="mood-description"><p>Good</p></div></div></a><a href="#/main/mood/5"><div class="emoji-mood-container"><div class="mood-emoji emoji-1">&nbsp;</div><div class="mood-description"><p>Fantastic</p></div></div></a></div></div>';break;case"pushNotificationReminder":a='<div class="popdown notification-green"><div class="notification-msg"><h4>'+n+"</h4></div></div>";break;case"reportCommentConfirmation":a='<div class="popdown notification-green"><div class="notification-msg"><h4>'+n+"</h4></div></div>";break;case"reportPostConfirmation":a='<div class="popdown notification-green"><div class="notification-msg"><h4>'+n+"</h4></div></div>";break;case"reportCompletedNotification":a="<div class='popdown notification-green'><div class='notification-msg'><h4>"+n+"</h4></div></div>"}a=a.replace(/['"]/g,"&quot;"),o.get("notificationType")!=n&&(i.push('{"html" : "'+a+'", "duration" : '+t+" }"),o.set("notificationType",n),g++,i.length<=1&&h())},h=this.dropdownIn=function(){if(i.length>0){var t=JSON.parse(i[0]).html;t=t.replace(/&quot;/g,'"');var n=t;$("body").append(n),"emotion"!=m&&$(".popdown").click(function(){v(),"pushNotificationReminder"==m&&(window.location.href="#/notificationUserAdmin"),o.unset("notificationType")}),"reportCommentConfirmation"==m&&$(".popdown").click(function(){v(),o.unset("notificationType"),e.post("/api/comment/report",{postid:commentReportIDs.post_id,commentid:commentReportIDs.comment_id,userid:commentReportIDs.user_id,groupid:commentReportIDs.group_id}).then(function(e){console.log(e),setTimeout(function(){f("reportCompletedNotification",1e4,"The comment has been reported as inappropriate")},1200)}),$("#comment-report-"+commentReportIDs.comment_id).remove(),o.unset("notificationType")}),"reportPostConfirmation"==m&&$(".popdown").click(function(){v(),o.unset("notificationType"),console.log("ss"),console.log(postReportIDs),e.post("/api/post/report",{postid:postReportIDs.post_id,userid:postReportIDs.user_id,groupid:postReportIDs.group_id}).then(function(e){console.log("Send Email : OK"),setTimeout(function(){f("reportCompletedNotification",5e3,"The post has been reported as inappropriate")},1200)}),$("#post-report-"+postReportIDs.post_id).remove(),o.unset("notificationType")}),w(JSON.parse(i[0]).duration)}},v=this.dismissDropdown=function(e){$(".popdown").css("top","-14%"),setTimeout(function(){$(".popdown").remove(),i.shift(),h()},1e3)},w=this.activeDropDown=function(e){function t(){return function(){$(".popdown").css("top","0"),setTimeout(function(){$(".popdown").css("top","-14%"),setTimeout(function(){$(".popdown").remove(),i.shift(),o.unset("notificationType"),g=0,h()},1e3)},d)}}d=e,setTimeout(t(),500)}}),app.factory("FlashService",function(e){return{show:function(t){e.removeAjaxLoader()},showSuccess:function(t){e.successMessage=t},showError:function(t){e.errorMessage=t},clear:function(){e.flash="",e.successMessage="",e.errorMessage=""}}}),app.factory("SessionService",function(){return{get:function(e){return sessionStorage.getItem(e)},set:function(e,t){return sessionStorage.setItem(e,t)},unset:function(e){return sessionStorage.removeItem(e)},clearAll:function(){return sessionStorage.clear()}}}),app.service("APICallService",function(e,t,o,n,s,r,a){return{getNativeAppStatus:function(){var t=e({method:"GET",url:"/api/global/isNativeApp",data:{}});return t},addPost:function(e){return a.http({method:"POST",url:"api/add/post",headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;return t.append("post",angular.toJson(e.postData)),t.append("file",e.file),t},data:{postData:e,file:e.status_file}}).progress(function(e){appViews.updateProgress(parseInt(100*e.loaded/e.total))})},fetchPosts:function(e,t){},fetchPendingTask:function(t,o){console.log("fetchPendingTask"),e.post("/api/mission/getPendingTask",{groupid:o}).success(function(e,t,o,s){console.log("getPendingTask-success");var r={title:e.title,mission:e.mission,didyouknow:e.didyouknow,reference:e.reference,taskid:e.taskid};n.set("pendingTaskDetails",angular.toJson(r)),n.set("pendingTask",e.taskid),$("#hideCurrentMission").css("display","none")}).error(function(e,t,o,n){console.log("error")})},fetchPendingT:function(t,o){e.post("/api/mission/getPendingTask",{groupid:o}).success(function(e,t,o,s){$scope.pendingTaskDetails={title:e.title,didyouknow:e.didyouknow,reference:e.reference,taskid:e.taskid},n.set("pendingTaskDetails",angular.toJson($scope.pendingTaskDetails)),n.set("pendingTask",e.taskid),$("#hideCurrentMission").css("display","none")}).error(function(e,t,o,n){})},likePost:function(t,o,n){var s=e({method:"POST",url:"/api/user/post/like",data:{userid:t,groupid:o,postid:n}});return s},acceptMission:function(t,o,s){return n.get("pendingTask")?void 0:e({url:"/api/user/acceptmission",method:"POST",data:{userid:t,groupid:o,taskid:s}})},fetchWellbeingTracks:function(t){console.log("Groupid: "+t),e({url:"api/user/wellbeingtracks",method:"POST",data:{groupid:t}}).then(function(e){console.log("Wellbeing data fetched"),console.log(e.data),n.set("moodmap",angular.toJson(e.data))})},fetchWellbeingData:function(t){return console.log("Groupid: "+t),e({url:"api/user/wellbeingtracks",
method:"POST",data:{groupid:t}})},addComment:function(t){var o={comment:t.comment,post_id:t.post_id,user_id:t.user_id};e({url:"api/add/comment",method:"POST",data:{comment:t.comment,post_id:t.post_id,user_id:t.user_id}}).then(function(e){})},markSurveyComplete:function(o){e({url:"api/user/survey/complete",method:"POST",data:{survey:o}}).then(function(){t.path("/main")})},updateMood:function(t,o){return e({url:"api/user/mood/update",method:"POST",data:{groupid:t,mood:o}})},updateTaskScore:function(t,o){return e({url:"api/user/taskscore",method:"POST",data:{taskid:t,score:o}})},progressBar:function(e){return console.log("Sending the feedback"),"string"},sendFeedback:function(t){return e({url:"api/user/feedback",method:"POST",data:{feedback:t}})}}}),app.filter("htmlStripper",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}}),app.controller("LoginCtrl",function(e,t,o,n,s,r,a,i,c,l,p){e.Lang=t.Lang;var u="",d=localStorage.getItem("username");d&&(u=localStorage.getItem("username")),e.loginMessage="",r.getNativeAppStatus().success(function(e){usingUniWebView=e});var m=n.path();"/forgot-pwd"!=m&&a.logout(),l.contentWrapperLoader(),i.set("preSurveyCompleted",0),i.set("postSurveyCompleted",0),e.remember_username=!0,e.credentials={username:u,password:""},1==l.fromResetPwd&&(p.newDropdown("notification",5e3,"Success. Check email"),l.fromResetPwd=0),e.credentials.username?$("#pword").focus():$("#uname").focus(),l.removeContentWrapperLoader(),e.login=function(){var t=e.credentials;if(e.loginMessage="",t.username?t.password||(e.loginMessage="Please enter password",$("#pword").focus()):(e.loginMessage="Please enter email",$("#uname").focus()),""==e.loginMessage)l.ajaxLoader(),a.login(e.credentials).success(function(t){n.path("/main"),e.storeUsername(),l.removeAjaxLoader()}).error(function(e){});else var o=n.path()},e.resetPwd=function(){e.errorMessage="";var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/;e.emailforreset&&t.test(e.emailforreset)?(l.ajaxLoader(),c.post("/api/service/forgotpwd",{email:e.emailforreset}).success(function(e,t,o,s){"OK"==e?(l.fromResetPwd=1,n.path("/login")):p.newDropdown("warning",5e3,e),l.removeAjaxLoader()})):e.errorMessage="Please enter a valid email"},e.logout=function(){a.logout()},e.navigateTo=function(e){n.path("/"+e)},e.rememberUsername=function(){e.remember_username?e.remember_username=!1:e.remember_username=!0},e.storeUsername=function(){e.remember_username?localStorage.setItem("username",e.credentials.username):localStorage.setItem("username","")},e.$on("$viewContentLoaded",function(){$("#page-loader").hide(),$(".content-wrapper").css("display","0")}),l.removeAjaxLoader()}),app.controller("ByPassCtrl",function(e,t,o,n,s,r,a,i,c){var l={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="",o,n,s,r,a,i,c,p=0;for(e=l._utf8_encode(e);p<e.length;)o=e.charCodeAt(p++),n=e.charCodeAt(p++),s=e.charCodeAt(p++),r=o>>2,a=(3&o)<<4|n>>4,i=(15&n)<<2|s>>6,c=63&s,isNaN(n)?i=c=64:isNaN(s)&&(c=64),t=t+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(i)+this._keyStr.charAt(c);return t},decode:function(e){var t="",o,n,s,r,a,i,c,p=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");p<e.length;)r=this._keyStr.indexOf(e.charAt(p++)),a=this._keyStr.indexOf(e.charAt(p++)),i=this._keyStr.indexOf(e.charAt(p++)),c=this._keyStr.indexOf(e.charAt(p++)),o=r<<2|a>>4,n=(15&a)<<4|i>>2,s=(3&i)<<6|c,t+=String.fromCharCode(o),64!=i&&(t+=String.fromCharCode(n)),64!=c&&(t+=String.fromCharCode(s));return t=l._utf8_decode(t)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",o=0;o<e.length;o++){var n=e.charCodeAt(o);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){for(var t="",o=0,n=c1=c2=0;o<e.length;)n=e.charCodeAt(o),128>n?(t+=String.fromCharCode(n),o++):n>191&&224>n?(c2=e.charCodeAt(o+1),t+=String.fromCharCode((31&n)<<6|63&c2),o+=2):(c2=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),o+=3);return t}};console.log(o),e.credentials={username:"Master Roller lp001",password:"Master123$"};var p=e.credentials,u="";s.login(e.credentials).success(function(t){n.path("/main"),e.storeUsername()}),e.storeUsername=function(){e.remember_username?localStorage.setItem("username",e.credentials.username):localStorage.setItem("username","")}}),app.controller("SignUpCtrl",function(e,t,o,n,s,r,a,i,c,l,p){e.Lang=t.Lang;var u="",d=localStorage.getItem("username"),m=!1;e.lastID="",e.errorMessage="",e.showStep1=!0,e.showStep2=!1,e.showStep3=!1,$("#signup-firstname").focus(),r.unset("liveAppNotificationSession"),r.unset("lastCompletedMission"),r.unset("messageGroupUser"),r.unset("messageid"),r.unset("messageusername"),r.unset("moodCheck"),r.unset("postSurveyCompleted"),r.unset("preSurveyCompleted"),r.unset("usertemp"),c.contentWrapperLoader(),e.isDisabled="false",e.newuser={firstname:r.get("temp.fname"),lastname:r.get("temp.lname"),username:r.get("temp.uname"),password:r.get("temp.pword"),email:r.get("temp.email"),confirmemail:r.get("temp.cemail")},e.keycode=r.get("temp.kcode"),e.receiveNotifications=function(){m=document.getElementById("receive-chrome-pn").checked,1==m&&registerForPush()},i.cc&&(e.keycode=i.cc,e.token=i.token,e.isDisabled="true"),e.checkKeyCode=function(e){},$("#signup-form input[type='text'], #signup-form input[type='password']").on("keyup keydown keypress",function(e){var t=$(this).parents(".form-step").attr("id");13==e.keyCode&&e.preventDefault()}),e.previousStep=function(t){var o="showStep"+t,n="showStep"+(t+1);e[o]=!0,e[n]=!1},e.enterStep2=function(){e.errorMessage1="",e.newuser.firstname&&e.newuser.lastname?(e.showStep1=!1,e.showStep2=!0):e.newuser.firstname?e.newuser.lastname||(e.errorMessage1="Please enter last name",$("#signup-lastname").focus()):(e.errorMessage1="Please enter first name",$("#signup-firstname").focus())},e.enterStep3=function(){e.errorMessage2="";var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/;e.newuser.email&&t.test(e.newuser.email)?a.post("/api/signup/isEmailExist",{email:e.newuser.email}).success(function(t,o,n,s){"true"==t?(e.errorMessage2="This email already exists",$("#signup-email").focus()):e.newuser.password?e.newuser.confirmpassword&&e.newuser.confirmpassword==e.newuser.password?(e.showStep2=!1,e.showStep3=!0):(e.errorMessage2="Password does not match!",$("#signup-confirmpass").focus()):(e.errorMessage2="Please enter password",$("#signup-pass").focus())}):(e.errorMessage2="Please enter a valid email",$("#signup-email").focus())},e.signUp=function(){e.errorMessage3="",e.newuser.keycode=e.keycode,e.newuser.token=e.token,e.newuser.keycode&&e.newuser.securitycode&&e.newuser.tos?(c.ajaxLoader(),a.post("/api/servcie/signup",e.newuser).success(function(t,n,s,i){return r.set("lastID",t.user_id),"true"==t.status?(o.path("/login"),l.newDropdown("notification",5e3,"Thanks. You can login below"),m&&pushUsersDeviceToDB(),p(function(){var e=r.get("playerid");a.get("https://onesignal.com/api/v1/players/"+e).success(function(e,t,o,n){a.post("/api/service/writePNtoDB",e).success(function(e,t,o,n){})})},3e3)):(e.errorMessage3=t.status,"Incorrect answer"==t.status?$("#signup-security").focus():"Your keycode is invalid"==t.status&&$("#keycode").focus()),c.removeAjaxLoader(),document.getElementById("secuimage").src="/securimage/securimage_show.php?"+Math.random(),!1;document.getElementById("securityinput").value=""})):e.newuser.securitycode?e.newuser.keycode?e.newuser.tos||(e.errorMessage3="Please agree to agreement"):(e.errorMessage3="Please enter key code",$("#keycode").focus()):(e.errorMessage3="Please answer the question in the picture",$("#signup-security").focus()),r.unset("temp.fname"),r.unset("temp.lname"),r.unset("temp.uname"),r.unset("temp.pword"),r.unset("temp.email"),r.unset("temp.cemail"),r.unset("temp.kcode"),r.unset("temp.state")},c.removeContentWrapperLoader(),e.saveTemporaryData=function(){""!=e.newuser.firstname&&(e.userTemp={firstname:e.newuser.firstname},r.set("usertemp",e.userTemp))}}),app.controller("MainCtrl",function(e,t,o,n,s,r,a,i,c,l,p){e.Lang=t.Lang,e.groupname="Mark's Happy Rollers",e.message="This is a test message",e.headMessage="",e.$watch(function(){return s.get("currentSelectedGroup")},function(t,o){e.currentGroup=null,e.currentGroup=JSON.parse(t),a.post("/api/group/user",{id:e.currentGroup}).success(function(t,o,n,s){e.groupUsers=t})}),e.$watch(function(){return s.get("user")},function(t,o){t&&(e.currentUser=JSON.parse(t),e.sessionUser=JSON.parse(t),e.setupGroup())}),e.currentSelectedGroupDetails=angular.fromJson(s.get("currentSelectedGroupDetails")),e.getGroupList=function(){return a.post("/api/group/list")},e.setCurrentGroup=function(t){s.set("currentSelectedGroup",t),s.unset("pendingTask"),s.unset("pendingTaskDetails"),e.currentGroup=t,e.flash="",angular.forEach(e.groups,function(o,n){o.id===t&&(e.currentSelectedGroupDetails=o,s.set("currentSelectedGroupDetails",angular.toJson(o)))}),l.fetchPendingTask(e.sessionUser.id,e.currentGroup),e.pendingTaskDetails=s.get("pendingTaskDetails"),e.pendingTask=s.get("pendingTask");var o=JSON.parse(s.get("currentSelectedGroupDetails"));e.headMessage=o.name},e.setupGroup=function(){e.getGroupList().then(function(t){var n=Math.round(+new Date/1e3);s.set("numOfDaysPassed",t.data[0].daysPassed);var r=localStorage.getItem("loginRedirect");null!=r&&(o.path("/"+r),localStorage.removeItem("loginRedirect")),e.hideGroupSelection=1,e.groups=t.data,e.setCurrentGroup(e.sessionUser.groups[0].id),e.currentGroup?a.post("/api/survey/isPresurveyCompleted",{groupid:e.currentGroup}).success(function(e,t,n,r){"true"==e?s.set("preSurveyCompleted",1):o.path("/presurveyintro")}):(e.displayGroupList=1,e.currentGroup=0)})},"null"==s.get("notificationType")&&s.unset("notificationType"),e.setHeader=function(e){$("#page-title").html(e)},e.navigateTo=function(e){"play"==e?100==s.get("progressPercentage")?(o.path("/missionCompleted"),p.newDropdown("notification",2500,"Fantastic - goal completed!")):s.get("numOfDaysPassed")==s.get("taskCompleted")?s.get("pendingTaskDetails")?p.newDropdown("notification",2500,"Please complete pending mission"):p.newDropdown("notification",2500,"Missions up to date. Roll again tomorrow!"):o.path("/play"):o.path("/"+e)},e.setActiveMenu=function(e){$("#header ul a").removeClass("active"),$("#mobile-nav a").removeClass("active"),"none"!=e&&($("#header ul a#link-"+e).addClass("active"),$("#mobile-nav a#menu-"+e).addClass("active"))},e.togglePopup=function(e){$(".popup-"+e).toggleClass("popup-inactive popup-active"),"active"==e&&$("#full-image img").hide()},e.pendingTask=function(){a.post("/api/mission/getPendingTask",{groupid:e.currentGroup}).success(function(t,o,n,r){1==t.date&&"true"!=s.get("missionPending")&&(s.set("missionPending","true"),c.callNotification("You","missionpending")),e.pendingTaskDetails={title:t.title,didyouknow:t.didyouknow,reference:t.reference,taskid:t.taskid,date:t.date},s.set("pendingTaskDetails",angular.toJson(e.pendingTaskDetails)),s.set("pendingTask",t.taskid),$("#hideCurrentMission").css("display","none")}).error(function(e,t,o,n){})},e.pendingTask(),e.currentGroupNotSelected=function(){return s.get("currentSelectedGroup")?!1:!0},e.logout=function(){r.logout(),o.path("/login")}}),app.controller("JournalCtrl",function(e,t,o,n,s,r,a,i,c,l,p){e.headTitle="journal",e.headMessage="",e.displayWordcloud=0,e.displayGroupList=0,e.displayWall=0,e.displayPhotoMontage=0,e.displayMoodMap=0,e.posts="",e.wordCloud="",e.photos="",e.progress=0,e.weekday=moment().format("dddd"),e.date=moment().format("DD"),e.dialProgress=null,e.userProgress=null,e.setHeader("Journal"),e.setActiveMenu("journal");var u=new Date,d=("0"+u.getDate()).slice(-2),m=("0"+(u.getMonth()+1)).slice(-2),g=u.getFullYear()+"-"+m+"-"+d;e.month=moment().format("MM"),e.montageCreated=0,e.ppb=0;var f=1e4,h=3e4,v=null;e.randomIMG=Math.floor(Math.random()*(h-f+1))+f,i.contentWrapperLoader(),$(window).width()<=499&&($(".progress-circle").click(function(){$(this).hide(),$(".progress-detailed-info").show()}),$(".progress-detailed-info").click(function(){$(this).hide(),$(".progress-circle").show()}));var w=t.path().search("/main/mood");0==w&&s({url:"api/global/moodCheckTime",method:"POST"}),1==e.sessionUser.role&&(e.complete=!0),e.resetAll=function(){e.displayWordcloud=0,e.displayGroupList=0,e.displayWall=0,e.displayPhotoMontage=0,e.displayMoodMap=0},e.setupCharts=function(t){console.log("Set up charts"),e.flash="",l.progressBar(t),l.fetchWellbeingData(e.currentGroup).success(function(t){v=t,e.getMoodData(),e.startMoodMapAni()}),e.getMoodData=function(){s({url:"api/global/getProgress",method:"POST",data:{groupid:e.currentGroup}}).then(function(t){console.log("Progress Data"),console.log(t);var o=t.data.progress;c.set("progressPercentage",o),e.ppb=o,e.InitUserProgress(t.data,e)})},e.resetAll(),e.displayMoodMap=1},e.setupCharts(),e.loadProgress=function(t){if(Date.now||(Date.now=function(){return(new Date).getTime()}),e.preSurveyCompleted=c.get("preSurveyCompleted"),e.postSurveyCompleted=c.get("postSurveyCompleted"),e.preSurveyCompleted?e.postSurveyCompleted||c.set("postSurveyCompleted",e.currentSelectedGroupDetails.postSurveyCompleted):c.set("preSurveyCompleted",e.currentSelectedGroupDetails.preSurveyCompleted),e.currentGroup){var o=Math.floor(21-(Math.floor(Date.now()/1e3)-e.currentSelectedGroupDetails.timestart)/86400);e.headMessage=e.currentSelectedGroupDetails.name}else{var o=0;e.headMessage="Please select team"}if(e.currentDay=o,0===e.currentGroup){var n=0;e.progress=0}else if(e.currentDay<=0){var n=100;e.progress=n,e.getWallPosts()}else{var n=Math.floor(e.currentDay/21);e.progress=n,e.getWallPosts()}},e.mysql_to_unix=function(e){return Math.floor(new Date(e).getTime()/1e3)},e.getWallPosts=function(){var t=s({method:"POST",url:"/api/group/private/posts",data:{groupid:e.currentGroup}});t.success(function(t){e.posts=t,t.length<1&&$(".journal-wall-posts").html(e.noPost)})},e.getWordsForCloud=function(){$("#tagcloud").html(e.disabledFeatureMsg)},e.getPhotosForMontage=function(){s.post("/api/user/photos").success(function(t){e.photos=t})},e.canDisplay=function(t){if("currentmission"===t){if(e.currentGroup&&c.get("pendingTask"))return!1}else if("play"===t&&e.currentGroup&&!c.get("pendingTask"))return!1;return!0},e.dothis=function(){},e.$on("$viewContentLoaded",function(t){console.log("=========="),console.log(e.sessionUser),"1"==e.sessionUser.notification?c.set("liveAppNotificationSession","true"):c.set("liveAppNotificationSession","false"),"0"==e.sessionUser.push_notification&&"true"!=c.get("chromeReminderFlag")&&c.set("chromeReminderFlag","true"),r(function(){s({url:"api/global/taskCompleted",method:"POST"}).then(function(e){c.set("taskCompleted",e.data)}),i.removeContentWrapperLoader(),setTimeout(function(){console.log("REGISTRERD USSER DATE "+e.mysql_to_unix(e.sessionUser.created_at));var t=Math.round(+new Date/1e3);e.hideGroupSelection=1,console.log("===="),console.log(c.get("user")),console.log("===="),e.getWordsForCloud(),e.getPhotosForMontage(),e.resetAll(),1===e.sessionUser.groupCount&&1!=e.sessionUser.role?e.displayGroupList=0:(e.hideGroupSelection=0,e.displayGroupList=1,i.removeContentWrapperLoader()),e.currentGroup?(e.resetAll(),e.displayMoodMap=1,e.loadProgress(e.currentGroup)):(e.resetAll(),e.displayGroupList=1,e.currentGroup=0),setTimeout(function(){e.currentGroup||p.newDropdown("notification",4e7,"Please select a team")},4e3)},1e3)}),100==c.get("progressPercentage")&&(e.allCompleted=!0,$(".button-gre").remove())}),e.humanReadable=function(e){return moment(e).fromNow()},e.UserProgress=function(t){var o=e.UserProgress._width,n=e.UserProgress._height,s=e.UserProgress._day,r=e.UserProgress._date,a=e.UserProgress._progress,i=0,c=e.UserProgress._completedDays;t.lightBlue=t.color(47,143,188),t.darkBlue=t.color(24,82,110),t.cream=t.color(242,208,141),t.setup=function(){t.size(o,n),t.frameRate(35),t.background(0,0),t.textFont(t.createFont("Raleway",30))},t.draw=function(){if(t.background(0,0),t.strokeWeight(n/20),t.stroke(t.darkBlue),t.fill(t.lightBlue),t.ellipse(o/2,n/2,.75*n,.75*n),t.noFill(),t.strokeWeight(n/15),t.stroke(t.cream),t.strokeCap(t.SQUARE),i+=(a-i)/4,t.arc(o/2,n/2,.84*n,.84*n,t.radians(270),t.radians(270+3.6*i)),Math.round(a)==Math.round(i)&&t.arc(o/2,n/2,.84*n,.84*n,t.radians(270),t.radians(270+3.6*a)),t.smooth(),t.maxFontSize=.2,t.textSize(t.maxFontSize*(1.4*n)),t.prog_str=i.toFixed(0)+"%",t.percent_width=t.textWidth(t.prog_str),t.fill(t.cream),t.text(t.prog_str,.5*(o-t.percent_width),.53*n),t.textSize(t.maxFontSize*(.35*n)),t.prog_str="complete!",t.percent_width=t.textWidth(t.prog_str),t.fill(t.cream),t.text(t.prog_str,.5*(o-t.percent_width),.64*n),t.textSize(t.maxFontSize*(.35*n)),t.prog_str="Day "+c,t.percent_width=t.textWidth(t.prog_str),t.fill(t.darkBlue),t.text(t.prog_str,.5*(o-t.percent_width),.78*n),Math.round(a)==Math.round(i)){t.noLoop();var e=Math.round(+new Date/1e3)}}},e.InitUserProgress=function(t,o){console.log("Init User Progress");var n=t.progress;e.progressPercent=t.progress,e.totalMissions=t.total_mission,e.completedDays=t.completed_days,console.log("PROGRESS DATA"),console.log(t),e.completedMissions=t.completed_missions,e.userProgress=n,e.complete=!0,e.drawProgress(n)},$(window).resize(function(){e.dialProgress=0,e.drawProgress()}),e.drawProgress=function(){e.dialProgress=e.userProgress,$(window).width()>=375?e.progressRadius=75:e.progressRadius=57},e.MoodMap=function(t){t.lightBlue=t.color(47,143,188),t.darkBlue=t.color(24,82,110),t.cream=t.color(242,208,141),t.white=t.color(242,208,141),t.title="MOOD MAP";var o=e.MoodMap._width,n=e.MoodMap._height,s=e.MoodMap._moodPoints,r=[],a=0;t.setup=function(){t.size(o,n),t.frameRate(35),t.background(0,0),t.textFont(t.createFont("Raleway",30));for(var e=0;e<s.length;e++)r[e]=t.height;console.log("moodpoints: "+s),console.log("MoodMap.height: "+t.height)},t.draw=function(){t.background(0,0),t.spacing_h=t.width/s.length,t.spacing_v=.75*t.height/7,t.padding=t.spacing_h/2,t.moodHigh=new PVector(0,t.height),t.prevPoints;for(var o=0;o<s.length;o++){t.noStroke(),t.fill(t.white),t.x=t.padding+t.spacing_h*o;var n=t.height-t.spacing_v*s[o]+75;t.y=r[o]+=(n-r[o])/8,t.ellipse(t.x,t.y,5,5),o>0&&(t.stroke(t.white),t.strokeWeight(2),t.line(t.prevPoints.x,t.prevPoints.y,t.x,t.y)),t.y<t.moodHigh.y&&(t.moodHigh.x=t.x,t.moodHigh.y=t.y),t.prevPoints=new PVector(t.x,t.y)}t.strokeWeight(0),t.stroke(t.white,50),t.noFill();var i=e.MoodMap._moodPoints.length,c=Math.round(t.height-t.spacing_v*s[i-1]),l=Math.round(r[i-1]),p=a+=(t.width-a)/i;if(c==l||0==i){t.noLoop();var u=1e3,d=10;$(".bar1").delay(0).animate({width:d*e.MoodMap.bar1_width+"%",overflow:"auto !important"},u),$(".bar2").delay(500).animate({width:d*e.MoodMap.bar2_width+"%",overflow:"auto !important"},u),$(".bar3").delay(1e3).animate({width:d*e.MoodMap.bar3_width+"%",overflow:"auto !important"},u),$(".bar4").delay(1500).animate({width:d*e.MoodMap.bar4_width+"%",overflow:"auto !important"},u),$(".bar5").delay(2e3).animate({width:d*e.MoodMap.bar5_width+"%",overflow:"auto !important"},u,function(){var e=Math.round(+new Date/1e3)}),$(".emoji-usage1").html(e.MoodMap.bar1_width),$(".emoji-usage2").html(e.MoodMap.bar2_width),$(".emoji-usage3").html(e.MoodMap.bar3_width),$(".emoji-usage4").html(e.MoodMap.bar4_width),$(".emoji-usage5").html(e.MoodMap.bar5_width)}}},e.getRandomMood=function(e,t){return Math.round(e+Math.random()*t)},e.InitMoodMap=function(){e.MoodMap.bar1_width=0,e.MoodMap.bar2_width=0,e.MoodMap.bar3_width=0,e.MoodMap.bar4_width=0,e.MoodMap.bar5_width=0,e.MoodMap._moodPoints=new Array;for(var t=v.length,o=0;t>o;o++)e.MoodMap._moodPoints.push(2*(parseInt(v[o].mood,0)+1)),1===parseInt(v[o].mood,0)?e.MoodMap.bar1_width+=1:2===parseInt(v[o].mood,0)?e.MoodMap.bar2_width+=1:3===parseInt(v[o].mood,0)?e.MoodMap.bar3_width+=1:4===parseInt(v[o].mood,0)?e.MoodMap.bar4_width+=1:5===parseInt(v[o].mood,0)&&(e.MoodMap.bar5_width+=1);e.MoodMap._width=500/7*e.MoodMap._moodPoints.length,e.MoodMap._height=$(".mood-data").height()},e.startMoodMapAni=function(){e.InitMoodMap();var t=document.getElementById("mood-map"),o=new Processing(t,e.MoodMap)},i.mood=e.updateMood=function(t){a.log(t),l.updateMood(e.currentGroup,t).then(function(t){a.log(t),$("#emoicon").remove(),$(".mood-map").empty().append("<canvas class='canvas-mood-map' id='mood-map'></canvas>");var o=document.getElementById("mood-map"),n=new Processing(o,e.MoodMap);location.reload()}),c.set("moodCheck",!1),p.dismissDropdown(1)},n.moodcode&&e.updateMood(n.moodcode),e.photoMontage=function(){$(".photo-container").html(e.disabledFeatureMsg)},e.displayWordCloud=function(){}}),app.controller("DiceCtrl",function(e,t,o,n,s,r,a,i,c,l){e.currentSelectedGroupDetails=angular.fromJson(a.get("currentSelectedGroupDetails")),e.headTitle="play",e.headMessage=e.currentSelectedGroupDetails.name,e.user=angular.fromJson(a.get("user")),e.groupid=a.get("currentSelectedGroup"),e.pendingTaskDetails=angular.fromJson(a.get("pendingTaskDetails")),e.pendingTask=a.get("pendingTask"),e.setHeader("Roll"),e.setActiveMenu("play"),e.groupid?e.pendingTask&&n.path("/mission"):n.path("/main"),userid=e.user.id,groupid=e.groupid,e.getTask=function(){},e.areAllTasksDone=function(){c.post("/api/global/areAllTasksDone",{groupid:e.groupid}).success(function(e,t,o,s){"false"==e?$(".top-layer-dice").css("display","none"):n.path("/missionCompleted")})},e.areAllTasksDone(),e.$on("$viewContentLoaded",function(){t.contentWrapperLoader(),init(),initDiceNum(),render(),s(i.clear,5e3),t.removeContentWrapperLoader()})}),app.controller("MissionCtrl",function(e,t,o,n,s,r){if(e.todayMission="",e.didyouknow="",e.reference="",e.taskid="",e.taskno="",e.user=angular.fromJson(n.get("user")),e.groupid=n.get("currentSelectedGroup"),e.pendingTaskDetails=angular.fromJson(n.get("pendingTaskDetails")),e.pendingTask=n.get("pendingTask"),e.headTitle="Mission",e.headMessage="Add a new post",e.setHeader("Mission"),e.setActiveMenu("play"),r.contentWrapperLoader(),$(".collapsible").collapsible({accordion:!1}),todayMission||n.get("pendingTask"))if(n.get("pendingTask")){var a=angular.fromJson(n.get("pendingTaskDetails"));console.log("PENDING TASK"),console.log(a),e.missionTitle=a.title,e.todayMission=a.mission,e.didyouknow=a.didyouknow,e.reference=a.reference,e.taskid=a.taskid,e.taskno=a.taskno,console.log(e.reference)}else e.missionTitle=missionTitle,e.todayMission=todayMission,e.didyouknow=didyouknow,e.reference=reference,e.taskid=taskid,e.taskno=score,console.log(e.reference);else t.path("/play");e.displayDidyouknow=!1,e.displayReference=!1,e.toggleSection=function(t){"#didyouknowBtn"==t?e.displayDidyouknow&&e.scrollToSection(t):e.displayReference&&e.scrollToSection(t)},e.scrollToSection=function(e){var t=$(e);return t=t.length?t:$("[name="+this.hash.slice(1)+"]"),t.length?(console.log(t),$(".scrollable-wrapper").animate({scrollTop:t.offset().top},1e3),!1):void 0},r.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1),e.acceptMission=function(){s.acceptMission(e.user.id,e.groupid,taskid).then(function(o){n.set("pendingTask",e.taskid),e.pendingTaskDetails={title:e.missionTitle,mission:e.todayMission,didyouknow:e.didyouknow,reference:e.reference,taskno:e.taskno,taskid:e.taskid},n.set("pendingTaskDetails",angular.toJson(e.pendingTaskDetails)),t.path("/wall")},function(e){});var o=parseInt(n.get("taskCompleted"))+1;n.set("taskCompleted",o)}}),app.controller("MessageCtrl",function(e,t,o,n,s,r){e.setHeader("messages"),e.setActiveMenu("message"),e.headTitle="messages",e.headMessage="All Messages",r.contentWrapperLoader(),e.messageListInt=function(){var t=s(function(){e.messageList()},5e3)},e.messageListInt(),r.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1),e.messageList=function(){e.messages=[],"/messages"==currentRoute&&o.post("/api/service/groupmessage/getConversationList").success(function(o,n,s,r){e.messages=angular.fromJson(o),angular.forEach(e.messages,function(t,o){var n=JSON.parse(t.members);e.messages[o].members=n}),0==e.messages.length&&"/messages"==t.path()&&$(".messages").html('<div class="empty-content-message">You currently have no messages.<br> To send a message use the NEW MESSAGE buton below.</div>')}).error(function(e,t,o,n){})},e.messageList(),e.messageView=function(e,t){var o=[{id:e,full_name:t}];n.set("selectedUsers",JSON.stringify(o)),location.href="#/message/"+e},e.humanReadable=function(e){var e=moment(e).fromNow(),t=e.indexOf("in a minute");return t>-1&&(e="a few seconds ago"),e},e.openMessage=function(e){location.href="#/message/view/"+e},e.createNewConversation=function(){location.href="#/nmSelectUser"}}),app.controller("MessageLocationCtrl",function(e,t,o,n,s,r){var a=location.href.split("/");n.set("messageid",a[5]),location.href="#/messageView"}),app.controller("MessageSelectGroupCtrl",function(e,t,o,n,s){e.setHeader("Select Group"),e.setActiveMenu("message"),e.headTitle="Select Team",e.headMessage="",s.contentWrapperLoader(),o.post("/api/group/list").success(function(t,o,s,r){e.groups=t,1==t.length&&(n.set("messageGroupUser",t[0].id),location.href="#/nmSelectUser")}).error(function(e,t,o,n){}),s.removeContentWrapperLoader(),e.messageGroupUser=function(e){n.set("messageGroupUser",e),location.href="#/nmSelectUser"}}),app.controller("MessageSelectUserCtrl",function(e,t,o,n,s){e.setHeader("Select User"),e.setActiveMenu("message"),e.headTitle="Select User",s.contentWrapperLoader(),s.removeContentWrapperLoader(),e.openMessage=function(){alert("dasfds")},e.messageView=function(e,t){location.href="#/message/"+e}}),app.controller("MessageViewCtrl",function(e,t,o,n,s,r){e.setHeader("Message"),e.setActiveMenu("message"),e.headTitle="View Message",e.headMessage=n.get("messageusername"),e.selectedUsers={},e.$watch(function(){return n.get("selectedUsers")},function(t,o){e.selectedUsers={},e.selectedUsers=JSON.parse(t)});var a=0;s.contentWrapperLoader();var i=!1;conversationID=r.id,$(".setting-btn").dropdown({inDuration:300,outDuration:225,constrain_width:!1,hover:!0,gutter:0,belowOrigin:!1,alignment:"left"}),e.notificationSTT=function(){var t="false";0==e.notificationStatus?(t="true",1==e.notificationStatus):0==e.notificationStatus,o.post("/api/service/groupmessage/updateNotificationStatus",{conversationID:conversationID,st:t}).success(function(e,t,o,n){})},e.retrieveConversation=function(){"/message/view/:id"==currentRoute&&o.post("/api/service/groupmessage/retriveGroupMessage",{conversationID:conversationID}).success(function(t,o,s,r){e.messages=t.mlist,n.set("selectedUsers",t.user_list);var a=JSON.parse(t.user_list);angular.forEach(e.groupUsers,function(e,t){e.checked=!1,angular.forEach(a,function(t,o){e[0].id==t.id&&(e.checked=!0)})}),e.notificationStatus=t.status}).error(function(e,t,o,n){})},e.retrieveConversation(),setInterval(function(){e.retrieveConversation()},5e3),s.removeContentWrapperLoader(),e.showDropdown=function(){$("#settings-dropdown").toggleClass("hide "),$("#invisible-cover").toggleClass("hide ")},e.hideDropdown=function(){$("#invisible-cover").addClass("hide"),$("#settings-dropdown").addClass("hide")},e.sendMessage=function(){var t=n.get("selectedUsers"),s=e.commentnewtext;e.commentnewtext="",s&&o.post("/api/service/groupmessage/sendGroupMessage",{id:r.id,message:s,userList:t,conversationID:conversationID}).success(function(t,o,n,s){e.retrieveConversation(),e.commentnewtext="",$(".private-messages").animate({scrollTop:0},"slow"),e.retrieveConversation()})},e.humanReadable=function(e){return moment(e).fromNow()}}),app.controller("GroupMessageCtrl",function(e,t,o,n,s,r,a,i){e.setActiveMenu("message");var c=[];e.headTitle="Group Message",e.headMessage="Group Message",e.groupid=o.get("currentSelectedGroup"),e.user=o.get("user"),e.user=angular.fromJson(e.user),setInterval(function(){e.messageList(),$(".group-message-content-chat-container-chatscreen").scrollTop($(".group-message-content-chat-container-chatscreen")[0].scrollHeight)},3e3),e.init=function(){console.log(e.user);var t=new Object;t.uid=e.user.id,t.name=e.user.firstname+" "+e.user.lastname,c.push(t),e.avtivemembers=angular.fromJson(JSON.stringify(c)),o.get("conversationid")||a.post("/api/groupMessage/initRoomData",{gid:e.groupid}).success(function(e,t,n,s){o.set("conversationid",e.roomid),o.set("conversationtitle",e.title)}),e.title=o.get("conversationtitle")},e.init(),e.memberList=function(){a.post("/api/groupMessage/memberList",{gid:e.groupid}).success(function(t,o,n,s){e.members=angular.fromJson(t);var r="";jQuery.each(e.members,function(t,o){this[0].id==e.user.id&&(r=this[0].id)})}).error(function(e,t,o,n){})},e.memberList(),e.addMemberToList=function(t,n){var s=!1;if(console.log(c),console.log("++++++"),jQuery.each(c,function(e,t){console.log(this.name),this.name==n&&(s=!0)}),0==s){var r=new Object;r.uid=t,r.name=n,$("#group-list-item-number-"+t).css("background-color","#1B4C63"),c.push(r),e.avtivemembers=angular.fromJson(JSON.stringify(c)),$(".num-of-members").html(c.length)}a.post("/api/groupMessage/newMember",{roomid:o.get("conversationid"),newmemberid:r.uid,newmemberfname:r.name,userList:c}).success(function(t,o,n,s){e.messageList()})},e.removeMember=function(t,n){if(c.length<=1)alert("Error !");else{var s=[];$("#group-list-item-number-"+t).css("background-color",""),$("#group-list-member-"+t).remove(),jQuery.each(c,function(e,o){this.uid!=t&&s.push(this)}),c=s,e.avtivemembers=angular.fromJson(JSON.stringify(c)),$(".num-of-members").html(c.length)}a.post("/api/groupMessage/removeMember",{roomid:o.get("conversationid"),newmemberid:t,newmemberfname:n,userList:c}).success(function(t,o,n,s){e.messageList()})},e.sendMessage=function(){var t=e.commentnewtext;t&&a.post("/api/groupMessage/send",{id:o.get("conversationid"),message:t,userList:c}).success(function(t,o,n,s){e.commentnewtext="",e.messageList()})},e.messageList=function(){a.post("/api/groupMessage/messageList",{id:o.get("conversationid")}).success(function(t,o,n,s){e.messages=t,e.getTheCurrentUserLIst()})},e.messageList(),e.humanReadable=function(e){return moment(e).fromNow()},e.getTheCurrentUserLIst=function(){a.post("/api/groupMessage/getTheCurrentUserLIst",{id:o.get("conversationid")}).success(function(t,o,n,s){e.avtivemembers=angular.fromJson(t.userlist),console.log("+++++"+e.avtivemembers);var r="";jQuery.each(e.avtivemembers,function(e,t){$("#group-list-item-number-"+t.uid).css("background-color","#1B4C63")}),c=e.avtivemembers,$(".num-of-members").html(c.length)})},e.leaveChat=function(){a.post("/api/groupMessage/leaveChat",{id:o.get("conversationid")}).success(function(t,o,n,s){e.avtivemembers=angular.fromJson(t),c=e.avtivemembers,location.href="/#/groupMessageList"})}}),app.controller("WallCtrl",function(e,t,o,n,s,r,a,i,c,l,p){e.headTitle="Wall Posts",e.posts="",e.user=o.get("user"),e.displayLoading=1,e.loadingData=!1,e.feedbackPopdown=0,e.pendingTask=o.get("pendingTask");var u=0;e.currentUser=angular.fromJson(e.user),e.setHeader("Wall"),e.setActiveMenu("wall"),100==o.get("progressPercentage")&&$(".button-gre").html("GOAL COMPLETED!"),e.testYoutube=function(e){var t=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/ytscreeningroom\?v=|\/feeds\/api\/videos\/|\/user\S*[^\w\-\s]|\S*[^\w\-\s]))([\w\-]{11})[?=&+%\w-]*/gi;return t.test(e)},e.displayPosts=function(){if(i.contentWrapperLoader(),c.postid){var o=t({method:"POST",url:"/api/group/postByID",data:{postid:c.postid,groupid:e.currentGroup}});o.success(function(t){$("#team-posts .loading-spinner").hide(),e.posts=t,e.displayLoading=0})}else{var o=t({method:"POST",url:"/api/group/posts",data:{groupid:e.currentGroup}});o.success(function(o){if(console.log(o),$("#team-posts .loading-spinner").hide(),o.length>0){e.posts=o;for(var n in o)if(o[n].status&&e.testYoutube(o[n].status)){
if(o[n].status.indexOf("v=")>=0)var s=o[n].status.split("v=")[1];else var s=o[n].status.split(".be/")[1];e.posts[n].status="<iframe width='560' height='315' class='youtube-player' type='text/html' src='https://www.youtube.com/embed/"+s+"' frameborder='0' allowfullscreen></iframe>"}var r=t({method:"POST",url:"/api/group/countPosts",data:{groupid:e.currentGroup}});r.success(function(t){e.totalPosts=t})}else $(".team-posts").html('<div class="empty-content-message">You currently have no wall posts.<br> To create a new post use the NEW POST buton below.</div>');e.displayLoading=0})}i.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1)},e.likePost=function(e){var o={postid:e.id,type:"like"};if(e.like){o.type="unlike";var n=e.likeCount--}else var n=e.likeCount++;var s=t.post("/api/user/post/like",o);e.like=!e.like},e.humanReadable=function(e){var e=moment(e).fromNow(),t=e.indexOf("in a minute");return t>-1&&(e="a few seconds ago"),e},e.showDropdown=function(e){u=e,$("#dropdown-"+e).toggleClass("hide "),$("#invisible-cover").toggleClass("hide ")},e.hideDropdown=function(){$("#invisible-cover").addClass("hide"),$("#dropdown-"+u).addClass("hide")},e.zoomImage=function(e){$(".popup-inactive").toggleClass("popup-inactive popup-active"),$("#image-spinner").show();var t=$("#full-image");t.html(e);var o=t.width(),n=t.height();setTimeout(function(){var e=t.children(),s=e.width(),r=e.height();o>s&&n>r?(t.addClass("image-normal"),e.addClass("size-auto")):s>=o&&r>=n?s>=r?e.css("width","100%"):e.css("height","100%"):(o>=s?e.addClass("width-auto"):e.addClass("width-full"),n>=r?e.addClass("height-auto"):e.addClass("height-full")),$("#image-spinner").hide(),$("#full-image img").show()},1e3)},e.$on("$viewContentLoaded",function(){setTimeout(function(){e.displayPosts()},1e3),o.get("recentMissionCompleted")&&(e.feedbackPopdown=1,o.unset("recentMissionCompleted"))}),e.report=function(e,t,o){l.newDropdown("reportPostConfirmation",12e3,"Tap here to report the post! "),postReportIDs.post_id=e,postReportIDs.user_id=t,postReportIDs.group_id=o,console.log(postReportIDs)},e.focusComment=function(e){$("#post-"+e+" .comment-new input").focus()},e.reportComment=function(e,t,o,n){l.newDropdown("reportCommentConfirmation",12e3,"Tap here to report the comment!  "),commentReportIDs.post_id=e,commentReportIDs.comment_id=t,commentReportIDs.user_id=o,commentReportIDs.group_id=n,console.log(commentReportIDs)},e.loadMoreData=function(){if(!c.postid){e.displayLoading=!0;var o={groupid:e.currentGroup,limitfrom:e.posts.length};e.loadingData===!1&&(e.loadingData=!0,t.post("/api/group/posts",o).then(function(t){angular.forEach(t.data,function(t,o){if(t.status&&e.testYoutube(t.status)){if(t.status.indexOf("v=")>=0)var n=t.status.split("v=")[1];else var n=t.status.split(".be/")[1];t.status="<iframe width='560' height='315' class='youtube-player' type='text/html' src='https://www.youtube.com/embed/"+n+"' frameborder='0' allowfullscreen></iframe>"}e.posts.push(t)}),e.loadingData=!1,e.displayLoading=!1}))}},e.addComment=function(t,o){if(t.preventDefault(),console.log(o.activecomment),""!=o.activecomment){var s=angular.fromJson(e.user),r={comment:o.activecomment,user:s,time:moment().fromNow(),user_id:s.id,post_id:o.id};o.comments.push(r),o.activecomment="",n.addComment(r)}o.activecomment=""},e.closePopup=function(){e.feedbackPopdown=0,o.unset("recentMissionCompleted"),r.reload()},e.editPost=function(e){o.set("postedit.id",e),location.href="#/editpost"},e.toggleText=function(e){$("#post-mission-"+e).toggleClass("open closed").toggleClass("orange "),$("#post-mission-"+e).find(".mission-content").slideToggle(),$("#post-mission-"+e).find(".mission-title .icon").toggleClass("plus minus")}}),app.factory("postFactory",function(e){return{getPosts:e({method:"POST"})}}),app.controller("PostsCtrl",function(e,t,o,n,s,r,a,i){e.headTitle="posts",e.headMessage="Add a new post",e.hideFileUpload=!0,e.user=angular.fromJson(i.get("user")),e.showPostAs=!1,e.groupid=i.get("currentSelectedGroup"),e.pendingTaskDetails=angular.fromJson(i.get("pendingTaskDetails")),e.pendingTask=i.get("pendingTask"),e.imageSrc="",e.finalTask="",e.posting=!1,$(document).ready(function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("android")>-1;t&&"true"==usingUniWebView&&$(".post-new .status_text").focusin(function(){$(this).css("height","50%")}).focusout(function(){$(this).css("height","80%")})}),e.moods=[{name:"<img src='/images/icon/emoji/fantastic.png' /> <span class='mood-title'>Fantastic</span>",code:5},{name:"<img src='/images/icon/emoji/pretty-good.png' /> <span class='mood-title'>Pretty Good</span>",code:4},{name:"<img src='/images/icon/emoji/okey.png' /> <span class='mood-title'>Okay</span>",code:3},{name:"<img src='/images/icon/emoji/not-great.png' />  <span class='mood-title'>Not Great</span>",code:2},{name:"<img src='/images/icon/emoji/terrible.png' /> <span class='mood-title'>Terrible</span>",code:1}],$("#postForm select").material_select(),t.contentWrapperLoader(),n.post("/api/mission/detectLastMission",{taskid:e.pendingTask,groupid:e.groupid}).success(function(t,o,n,s){e.finalTask=t}).error(function(e,t,o,n){}),t.removeContentWrapperLoader(),e.post={status_text:"",status_file:"",type:e.pendingTask?"mission":"general",display_mission:e.pendingTask?!0:!1,all_teams:!1,mood:""},e.modalBox=function(){$("#post-image-form").click()},e.toggleDisplayMission=function(){"mission"==e.post.type?e.post.display_mission=!0:e.post.display_mission=!1},e.showPostAsMenu=function(){},e.param={},e.file="",e.$on("fileSelected",function(t,o){e.$apply(function(){e.file=o.file,e.post.status_file=o.file;var t=new FileReader;t.onload=function(t){e.imageSrc=t.target.result,e.$apply()},t.readAsDataURL(o.file)})}),e.addPost=function(c){console.log(e.post),t.ajaxLoader(),e.post.userid=e.user.id,e.post.groupid=e.groupid,e.post.taskid=e.pendingTask?e.pendingTask:0;var l=e.post.status_text.replace(/(\r\n|\n|\r)/gm,"");s.log(e.post);var p=/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/;e.post.status_text?e.post.status_text&&l.search(p)>=0?(a.newDropdown("warning",5e3,"This post does not support Vimeo"),t.removeAjaxLoader()):(e.posting=!0,e.post.mood&&(e.post.mood=e.post.mood.code),r.addPost(e.post).then(function(s){e.posting=!1,"mission"==e.post.type&&(i.unset("pendingTask"),i.unset("pendingTaskDetails"),i.set("recentMissionCompleted",1),i.set("lastCompletedMission",e.post.taskid),n({url:"/api/group/list",method:"POST"}).then(function(e){i.set("numOfDaysPassed",e.data[0].daysPassed)})),e.finalTask==e.post.taskid&&e.post.mission_completed?(location.href="#/wall",setTimeout(function(){location.href="#/postsurveyintro"},3e3)):o.path("/wall"),t.removeAjaxLoader()},function(e){console.log("An upload error occured writng post"),console.log(e),appViews.progressError("An upload error has occurred.<br/>Tap to continue.")})):(a.newDropdown("warning",5e3,"Please write a message"),t.removeAjaxLoader())},e.report=function(){alert("sss")},e.switchAllteams=function(){e.post.all_teams?e.post.all_teams=!1:(e.post.all_teams=!0,e.post["private"]=!1)},e.file_changed=function(e,t){var o=document.querySelector("input[type=file]").files[0],n=o.type,s="";if(n.indexOf("image")>=0){var r=new FileReader;o&&r.readAsDataURL(o),r.onloadend=function(){$(".uploaded-image-source").attr("src",r.result),$(".uploaded-image-source").css("display","block"),$(".uploaded-images").css("display","block"),s=r.result}}else a.newDropdown("warning",5e3,"Please make sure file is picture!")},e.removePreviewImage=function(){$(".uploaded-image-source").attr("src",""),$(".uploaded-image-source").css("display","none"),$(".uploaded-images").css("display","none");var t=$(".status_file");t.replaceWith(t.val("").clone(!0)),e.post.status_file=""}}),app.controller("PostEditCtrl",function(e,t,o,n,s,r,a,i,c){t.contentWrapperLoader(),e.headTitle="posts",e.headMessage="Edit a post",e.hideFileUpload=!0,e.user=angular.fromJson(c.get("user")),e.showPostAs=!1,e.groupid=c.get("currentSelectedGroup"),e.pendingTaskDetails=angular.fromJson(c.get("pendingTaskDetails")),e.pendingTask=c.get("pendingTask"),e.imageSrc="",e.finalTask="";var l="";$("#editForm select").material_select(),n.post("/api/post/fetchPostByID",{postid:c.get("postedit.id")}).success(function(o,n,s,r){e.post=o,console.log(o),1==o.mission_completed&&(e.post.type="mission"),1==o.general&&(e.post.type="general"),1==o["private"]&&(e.post.type="note"),""!=o.image&&($(".uploaded-image-source").attr("src",o.image),$(".uploaded-image-source").css("display","block"),$(".uploaded-images").css("display","block")),t.removeContentWrapperLoader()}).error(function(e,t,o,n){alert("An error ocurred !, please try again !")}),e.file_changed=function(e,t){var o=document.querySelector("input[type=file]").files[0],n=o.type;if(n.indexOf("image")>=0){var s=new FileReader;o&&s.readAsDataURL(o),s.onloadend=function(){$(".uploaded-image-source").attr("src",s.result),$(".uploaded-image-source").css("display","block"),$(".uploaded-images").css("display","block"),l=s.result}}else a.newDropdown("warning",5e3,"Please make sure file is picture!"),$(".status_file").remove(),$(".fileUpload").append('<input type="file"  onchange="angular.element(this).scope().file_changed(this)" class="status_file" data-file="post.status_file" upload-file ng-hide="hideFileUpload=0" />')},e.removePreviewImage=function(){$(".uploaded-image-source").attr("src",""),$(".uploaded-image-source").css("display","none"),$(".uploaded-images").css("display","none");var t=$(".status_file");t.replaceWith(t.val("").clone(!0)),e.post.status_file="",e.post.imgContent=""},e.report=function(){alert("sss")},e.switchAllteams=function(){e.post.all_teams?e.post.all_teams=!1:(e.post.all_teams=!0,e.post["private"]=!1)},e.editPost=function(o){console.log("ADD LOADER"),t.ajaxLoader();var n=e.post.status.replace(/(\r\n|\n|\r)/gm,""),s=/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/;if(e.post.status)if(e.post.status&&n.search(s)>=0)a.newDropdown("warning",5e3,"This post does not support Vimeo"),t.removeAjaxLoader();else{e.post.id=c.get("postedit.id");var r=document.querySelector("input[type=file]").files[0];console.log(r),i.http({method:"POST",url:"/api/post/submitEditedContent",headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;return t.append("post",angular.toJson(e.postData)),t.append("file",e.file),t},data:{postData:e.post,file:r}}).success(function(e){"OK"==e&&(location.href="#/wall",t.removeAjaxLoader())}).progress(function(e){appViews.updateProgress(parseInt(100*e.loaded/e.total))}).error(function(e,t,o,n){console.log("An error occured writng post"),console.log(e),appViews.progressError("An error has occurred.<br/>Tap to continue.")}),t.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1)}else a.newDropdown("warning",5e3,"Please write a message"),t.removeAjaxLoader()}}),app.controller("SurveyCtrl",function(e,t,o,n,s,r,a){e.groupid=r.get("currentSelectedGroup"),e.presurveyid=angular.fromJson(r.get("currentSelectedGroupDetails")).survey,e.postsurveyid=angular.fromJson(r.get("currentSelectedGroupDetails")).postsurvey,e.survey={type:"pre",group:parseInt(e.groupid),surveyid:0},e.markSurveyCompleted=function(t){"pre"===t?(e.survey.surveyid=e.presurveyid,r.set("preSurveyCompleted","1"),a.markSurveyComplete(e.survey),n.path("/main")):"post"===t&&(e.survey.type="post",e.survey.surveyid=e.postsurveyid,r.set("postSurveyCompleted","1"),a.markSurveyComplete(e.survey))}}),app.controller("SupportTicketCtrl",function(e,t,o,n,s,r,a,i){e.recentTaskCompleted="",e.headTitle="Support",e.errorMessage="",e.ticket={},e.setHeader("Contact Support"),e.setActiveMenu("none"),e.validateEmail=function(e){var t=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},e.sendTicket=function(){e.errorMessage="","true"==o.get("authenticated")?e.ticket.type?e.ticket.feedback||i.newDropdown("warning",5e3,"Please write a message"):i.newDropdown("warning",5e3,"Please select a subject"):e.ticket.name?e.ticket.email&&e.validateEmail(e.ticket.email)?void 0==e.ticket.type?e.errorMessage="Please select subject":e.ticket.feedback||(e.errorMessage="Please enter message"):e.errorMessage="Please enter a valid email ":e.errorMessage="Please enter name",""==e.errorMessage&&r.post("/api/global/supportFeedback",{name:e.ticket.name,email:e.ticket.email,type:e.ticket.type,feedback:e.ticket.feedback}).success(function(e,n,s,r){a.removeAjaxLoader(),"true"==o.get("authenticated")?t.path("/main"):t.path("/login"),i.newDropdown("notification",4e3,"Feedback sent")})}}),app.controller("HowtoCtrl",function(e,t,o){e.headTitle="OAR 21",e.headMessage="How to play",o.contentWrapperLoader(),e.setHeader("How To Play"),e.setActiveMenu("none"),$(".collapsible").collapsible({accordion:!0}),e.HowTo=function(e,t){var o=e,n=t,s=7,r=!1,a=function(){o.addEventListener("timeupdate",function(){i()},!0)};a();var i=function(){var e=100;o.currentTime<10?c(0):o.currentTime<20?c(e):o.currentTime<30?c(2*e):o.currentTime<40?c(3*e):o.currentTime<50?c(4*e):o.currentTime<60?c(5*e):o.currentTime<70&&c(6*e)},c=function(e){r||(r=!0,n.animate({marginLeft:"-"+e+"%"},700,function(){r=!1}))}},e.$on("$viewContentLoaded",function(){var t=new e.HowTo($(".how-to-play-video")[0],$(".how-to-info"))}),o.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1)}),app.controller("NotificationAdminCtrl",function(e,t,o,n,s,r,a,i){e.headTitle="Account",e.headMessage="Notification settings",e.setHeader("Notification Settings"),e.setActiveMenu("none"),a.contentWrapperLoader(),o.post("/api/notification/getNotification").success(function(t,o,n,s){"0"==t.push_notification?(e.pushnotificationcb=!1,r.set("pushnotificationcb",!1)):(e.pushnotificationcb=!0,r.set("pushnotificationcb",!0)),"0"==t.notification?(e.notificationcb=!1,r.set("liveAppNotificationSession",!1)):(e.notificationcb=!0,r.set("liveAppNotificationSession",!0)),"0"==t.notification_email?e.emailnotificationcb=!1:e.emailnotificationcb=!0,"0"==t.notification_web?e.webnotificationcb=!1:e.webnotificationcb=!0}),a.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1),e.notificationcbFunction=function(){var t=1;t=1==e.notificationcb?0:1,o.post("/api/notification/setNotification",{type:"normal",data:t}).success(function(e,t,o,n){"true"==r.get("liveAppNotificationSession")?r.set("liveAppNotificationSession",!1):r.set("liveAppNotificationSession",!0)}).error(function(e,t,o,n){})},e.emailnotificationcbFnction=function(){var t=1;t=1==e.emailnotificationcb?0:1,o.post("/api/notification/setNotification",{type:"email",data:t}).success(function(e,t,o,n){}).error(function(e,t,o,n){})},e.pushnotificationcbFnction=function(){var t=1;t=1==e.pushnotificationcb?0:1,o.post("/api/notification/setNotification",{type:"push",data:t}).success(function(e,t,o,n){})},e.webnotificationcbFunction=function(){var t=1;t=1==e.webnotificationcb?0:1,o.post("/api/notification/setNotification",{type:"web",data:t}).success(function(e,t,o,n){}).error(function(e,t,o,n){})}}),app.controller("AccountSettingsCtrl",function(e,t,o,n,s,r,a,i,c,l){e.headTitle="Account",e.headMessage="Account settings",r.contentWrapperLoader(),e.setHeader("User Settings"),e.setActiveMenu("none");var p=JSON.parse(i.get("user")),u=1e4,d=3e4;e.randomIMG=Math.floor(Math.random()*(d-u+1))+u,e.userAvatar=p.picture,$("#resetAvatar").css("display","none");var m="",g="";e.profile={username:p.username,firstname:p.firstname,lastname:p.lastname,email:p.email,screenname:p.screenhandle,state:p.state},e.populateImageContent=function(e){},e.resetAvatar=function(){$("#avatar").attr("src",p.picture+"?"+e.randomIMG),$("#profile img").attr("src",p.picture+"?"+e.randomIMG),$("#resetAvatar").css("display","none");var t=$("#fileInp");t.replaceWith(t.val("").clone(!0)),m="",g=""},e.file_changed=function(e,t){var o=document.querySelector("input[type=file]").files[0];g=o.type;var n=new FileReader;o&&n.readAsDataURL(o),n.onloadend=function(){var e=$("#avatar").attr("src",n.result);$("#profile img").attr("src",n.result),m=n.result},$("#resetAvatar").css("display","block")};var f=function(e){return $.param(e)};e.updateUser=function(o){var n=!0,s="";if(e.errorMessage="",e.profile.firstname)if(e.profile.lastname)if(e.profile.email)if(e.profile.password&&!e.profile.confirmpassword)e.errorMessage="Please confirm new password!";else if($.trim(e.profile.password)!=$.trim(e.profile.confirmpassword))e.errorMessage="Passwords did not match!";else{r.ajaxLoader();var i=e.fileInput;e.profile={fileType:g,firstname:e.profile.firstname,lastname:e.profile.lastname,email:e.profile.email,password:e.profile.password};var p=document.querySelector("input[type=file]").files[0];l.http({method:"POST",url:"api/user/update",headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;return t.append("post",angular.toJson(e.postData)),t.append("file",e.file),t},data:{postData:e.profile,file:p}}).success(function(e){if("OK"==e){c.newDropdown("notification",2e3,"Account settings updated"),c.newDropdown("notification",5e3,"Please log in"),$("#resetAvatar").css("display","none");var o=$("#fileInp");o.replaceWith(o.val("").clone(!0))}else c.newDropdown("notification",5e3,e);r.removeAjaxLoader(),a.logout(),t.path("/login")}).progress(function(e){appViews.updateProgress(parseInt(100*e.loaded/e.total))})}else e.errorMessage="Please enter email!";else e.errorMessage="Please enter last name!";else e.errorMessage="Please enter first name!"},r.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1)}),app.controller("NotificationCtrl",function(e,t,o,n,s,r,a,i){e.headTitle="notification center",e.headMessage="Notification Center",e.setHeader("Notifications"),e.setActiveMenu("notification"),a.contentWrapperLoader(),o.post("/api/notification/getNotificationList").success(function(t,o,n,s){e.notifications=angular.fromJson(t),0==e.notifications.length&&$(".notifications").append('<div class="empty-content-message">You currently have no notifications</div>')}).error(function(e,t,o,n){}),a.removeContentWrapperLoader(),$(".content-wrapper").fadeTo("slow",1),e.filterNewRoller=function(t){e.unsetIcons(),$("#filter-icon-new-roller").attr("src","images/filter-new-roller-active.png")},e.filterLike=function(t){e.unsetIcons(),$("#filter-icon-like").attr("src","images/icon/like-active.png")},e.filterComment=function(t){e.unsetIcons(),$("#filter-icon-comment").attr("src","images/icon/comment-active.png")},e.humanReadable=function(e){return moment(e).fromNow()},e.filterMsg=function(t){e.unsetIcons(),$("#filter-icon-message").attr("src","images/icon/nav/message-active.png")},e.unsetIcons=function(){$("#filter-icon-like").attr("src","images/icon/like-inactive.png"),$("#filter-icon-comment").attr("src","images/icon/comment-inactive.png"),$("#filter-icon-message").attr("src","images/icon/nav/message-inactive.png")},e.redirectToTarget=function(e,t,o){"newgroupmessage"==e&&(location.href="#/message/view/"+t),"message"==e&&(location.href="#/message/"+o),"newlike"==e&&(location.href="#/wall/"+t),("newcomment"==e||"newcommentother"==e)&&(location.href="#/wall/"+t)}}),app.controller("SupportCtrl",function(e,t,o,n,s,r){e.headTitle="Support",e.headMessage="FAQ & Support",e.setHeader("FAQ"),e.setActiveMenu("none"),$(".collapsible").collapsible({accordion:!0}),r.contentWrapperLoader(),r.removeContentWrapperLoader()}),app.controller("LegalCtrl",function(e,t,o,n,s){}),app.controller("HowtoOutsideCtrl",function(e,t,o,n,s){}),app.controller("MissionCompletedCtrl",function(e,t,o,n,s,r){e.headTitle="Play",e.headMessage="All missions accepted"}),app.controller("GroupMessageListCtrl",function(e,t,o,n,s,r){e.setHeader("messages"),e.setActiveMenu("message"),e.headTitle="conversations",e.headMessage="All Conversations",r.contentWrapperLoader(),e.messageList=function(){o.post("/api/groupMessage/searchByUserID").success(function(o,n,s,r){e.messages=angular.fromJson(o),0==e.messages.length&&"/groupMessageList"==t.path()&&$(".messages").html('<div class="empty-content-message">You currently have no conversations.<br> To create a conversation use the NEW CONVERSATION buton below.</div>')}).error(function(e,t,o,n){})},e.messageList(),r.removeContentWrapperLoader(),e.humanReadable=function(e){return moment(e).fromNow()},e.groupMessageView=function(e,t){n.set("conversationid",e),n.set("conversationtitle",t),location.href="/#/groupmessage/"+e},e.navigateWithCondition=function(e){n.set("conversationid",""),n.set("conversationtitle",""),location.href="/#/groupmessage"}}),app.controller("postNewController",function(e,t,o,n,s,r){alert("al")}),app.controller("PostAsCtrl",function(e,t,o,n,s,r,a){e.asPostText=a.posttext,$("#image-post-container").attr("src",postAsImg)}),app.controller("PreSurveyCtrl",function(e,t,o,n,s,r,a){function i(e){var t={},o,n,s=[],r="",a=String.fromCharCode,i=[[65,91],[97,123],[48,58],[43,44],[47,48]];for(var c in i)for(o=i[c][0];o<i[c][1];o++)s.push(a(o));for(o=0;64>o;o++)t[s[o]]=o;for(o=0;o<e.length;o+=72){var l=0,p,u,d=0,m=e.substring(o,o+72);for(u=0;u<m.length;u++)for(p=t[m.charAt(u)],l=(l<<6)+p,d+=6;d>=8;)r+=a((l>>>(d-=8))%256)}return r}e.headTitle="pre survey",e.headMessage=angular.fromJson(o.get("currentSelectedGroupDetails")).name,e.selectedGroupId=angular.fromJson(o.get("currentSelectedGroupDetails")).id,e.userid=angular.fromJson(o.get("user")).id,e.groupDetails=angular.fromJson(o.get("currentSelectedGroupDetails"));var c=0,l=0,p=!1,u=[];s.contentWrapperLoader(),console.log(e.groupDetails.thumbnail),e.logo=i(e.groupDetails.thumbnail),n.post("/api/survey/getSurveyList",{type:"pre",groupid:e.selectedGroupId}).success(function(t,o,s,r){e.questions=t,c=t.length,0==c?(e.headTitle="TEAM",e.template="/templates/widgets/pre-survey-without-content.html",n.post("/api/user/survey/completePreSurvey",{groupid:e.selectedGroupId,surveyid:10}).success(function(e,t,o,n){})):e.template="/templates/widgets/pre-survey-with-content.html"}),s.removeContentWrapperLoader(),e.presurveySwitch=function(){0==c?t.path("/main"):t.path("/presurvey")},e.saveResponse=function(){s.ajaxLoader(),p?($.ajax({url:"/api/survey/saveResponse",type:"post",dataType:"json",data:$("form#presurveyform").serialize(),success:function(e){o.set("preSurveyCompleted","1"),t.path("/main")}}),s.removeAjaxLoader(),r.newDropdown("notification",5e3,"Pre survey completed")):(r.newDropdown("warning",3e3,"Please answer all questions"),s.removeAjaxLoader())},e.optionSelect=function(e){for(var t=!1,o=0;o<u.length;o++){var n=u[o];n==e&&(t=!0)}t||u.push(e),u.length>=c&&(p=!0),l++},e.$on("$viewContentLoaded",function(e){})}),app.controller("PostSurveyCtrl",function(e,t,o,n,s,r,a){e.headTitle="post survey",e.headMessage=angular.fromJson(o.get("currentSelectedGroupDetails")).name,e.selectedGroupId=angular.fromJson(o.get("currentSelectedGroupDetails")).id,e.userid=angular.fromJson(o.get("user")).id,s.contentWrapperLoader();var i=0,c=0,l=!1,p=[];n({url:"api/global/getProgress",method:"POST",data:{groupid:e.selectedGroupId}}).then(function(e){o.set("progressPercentage",e.data)}),n.post("/api/survey/getSurveyList",{type:"post",groupid:e.selectedGroupId}).success(function(t,o,s,r){e.questions=t,i=t.length,0==i?(e.headTitle="TEAM",e.template="/templates/widgets/post-survey-without-content.html",n.post("/api/user/survey/completePostSurvey",{groupid:e.selectedGroupId,surveyid:10}).success(function(e,t,o,n){})):e.template="/templates/widgets/post-survey-with-content.html"}),s.removeContentWrapperLoader(),e.postsurveySwitch=function(){0==i?t.path("/main"):t.path("/postsurvey")},e.saveResponse=function(){s.ajaxLoader(),l?($.ajax({url:"/api/survey/saveResponse",type:"post",dataType:"json",data:$("form#postsurveyform").serialize(),success:function(e){o.set("postSurveyCompleted","1"),t.path("/main")}}),s.removeAjaxLoader(),r.newDropdown("notification",4e3,"Post survey completed"),r.newDropdown("notification",4e3,"Fantastic - goal completed!")):(r.newDropdown("warning",3e3,"Please answer all questions"),s.removeAjaxLoader())},e.optionSelect=function(e){for(var t=!1,o=0;o<p.length;o++){var n=p[o];n==e&&(t=!0)}t||p.push(e),p.length>=i&&(l=!0),c++},e.$on("$viewContentLoaded",function(){})});